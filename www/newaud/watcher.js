/*! For license information please see watcher.js.LICENSE.txt */
!function(){var e={1767:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const i=r(9397),o=r(3170),c=r(2267),d=new i.Logger("Consumer");class u extends o.EnhancedEventEmitter{constructor(e){let t=e.id,r=e.localId,n=e.producerId,a=e.rtpReceiver,s=e.track,i=e.rtpParameters,c=e.appData;super(),this._closed=!1,this._observer=new o.EnhancedEventEmitter,d.debug("constructor()"),this._id=t,this._localId=r,this._producerId=n,this._rtpReceiver=a,this._track=s,this._rtpParameters=i,this._paused=!s.enabled,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(d.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(d.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._closed){t.next=2;break}throw new c.InvalidStateError("closed");case 2:return t.abrupt("return",new Promise(((t,r)=>{e.safeEmit("@getstats",t,r)})));case 3:case"end":return t.stop()}}),t)})))()}pause(){d.debug("pause()"),this._closed?d.error("pause() | Consumer closed"):this._paused?d.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){d.debug("resume()"),this._closed?d.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):d.debug("resume() | Consumer is already resumed")}onTrackEnded(){d.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=u},2236:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;const n=r(9397),a=r(3170),s=new n.Logger("DataConsumer");class i extends a.EnhancedEventEmitter{constructor(e){let t=e.id,r=e.dataProducerId,n=e.dataChannel,i=e.sctpStreamParameters,o=e.appData;super(),this._closed=!1,this._observer=new a.EnhancedEventEmitter,s.debug("constructor()"),this._id=t,this._dataProducerId=r,this._dataChannel=n,this._sctpStreamParameters=i,this._appData=o||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let t=e.error;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}t.DataConsumer=i},129:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;const n=r(9397),a=r(3170),s=r(2267),i=new n.Logger("DataProducer");class o extends a.EnhancedEventEmitter{constructor(e){let t=e.id,r=e.dataChannel,n=e.sctpStreamParameters,s=e.appData;super(),this._closed=!1,this._observer=new a.EnhancedEventEmitter,i.debug("constructor()"),this._id=t,this._dataChannel=r,this._sctpStreamParameters=n,this._appData=s||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(i.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(i.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let t=e.error;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):i.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||i.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}t.DataProducer=o},7517:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686)),i=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},o=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const d=(T=r(6884))&&T.__esModule?T:{default:T},u=r(9397),p=r(3170),l=r(2267),f=c(r(4813)),m=c(r(3394)),h=r(7167),g=r(1058),v=r(4415),b=r(5942),y=r(6811),_=r(4588),w=r(1697),S=r(9657),x=r(7215),k=r(7535),R=r(4608),P=r(6890),C=new u.Logger("Device");var T;function D(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void C.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(C.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(C.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)C.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=d.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=111",chromium:">=111","microsoft edge":">=111"}))return"Chrome111";if(t.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=111?"Chrome111":e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome111"}C.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=D,t.Device=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.handlerName,r=e.handlerFactory,n=e.Handler;if(this._loaded=!1,this._observer=new p.EnhancedEventEmitter,C.debug("constructor()"),n){if(C.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof n)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");t=n}if(t&&r)throw new TypeError("just one of handlerName or handlerInterface can be given");if(r)this._handlerFactory=r;else{if(t)C.debug("constructor() | handler given: %s",t);else{if(t=D(),!t)throw new l.UnsupportedError("device not supported");C.debug("constructor() | detected handler: %s",t)}switch(t){case"Chrome111":this._handlerFactory=g.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=v.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=b.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=y.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=w.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=S.Safari12.createFactory();break;case"Safari11":this._handlerFactory=x.Safari11.createFactory();break;case"Edge11":this._handlerFactory=k.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=R.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=P.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${t}"`)}}const a=this._handlerFactory();this._handlerName=a.name,a.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new l.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new l.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.routerRtpCapabilities,C.debug("load() [routerRtpCapabilities:%o]",n),n=f.clone(n,void 0),r.prev=3,!t._loaded){r.next=6;break}throw new l.InvalidStateError("already loaded");case 6:return m.validateRtpCapabilities(n),s=t._handlerFactory(),r.next=10,s.getNativeRtpCapabilities();case 10:return i=r.sent,C.debug("load() | got native RTP capabilities:%o",i),m.validateRtpCapabilities(i),t._extendedRtpCapabilities=m.getExtendedRtpCapabilities(i,n),C.debug("load() | got extended RTP capabilities:%o",t._extendedRtpCapabilities),t._canProduceByKind.audio=m.canSend("audio",t._extendedRtpCapabilities),t._canProduceByKind.video=m.canSend("video",t._extendedRtpCapabilities),t._recvRtpCapabilities=m.getRecvRtpCapabilities(t._extendedRtpCapabilities),m.validateRtpCapabilities(t._recvRtpCapabilities),C.debug("load() | got receiving RTP capabilities:%o",t._recvRtpCapabilities),r.next=22,s.getNativeSctpCapabilities();case 22:t._sctpCapabilities=r.sent,C.debug("load() | got native SCTP capabilities:%o",t._sctpCapabilities),m.validateSctpCapabilities(t._sctpCapabilities),C.debug("load() succeeded"),t._loaded=!0,s.close(),r.next=34;break;case 30:throw r.prev=30,r.t0=r.catch(3),s&&s.close(),r.t0;case 34:case"end":return r.stop()}}),r,null,[[3,30]])})))()}canProduce(e){if(!this._loaded)throw new l.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport(e){let t=e.id,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,u=e.appData;return C.debug("createSendTransport()"),this.createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s,iceServers:i,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:u})}createRecvTransport(e){let t=e.id,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,u=e.appData;return C.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s,iceServers:i,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:u})}createTransport(e){let t=e.direction,r=e.id,n=e.iceParameters,a=e.iceCandidates,s=e.dtlsParameters,i=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.appData;if(!this._loaded)throw new l.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!=typeof n)throw new TypeError("missing iceParameters");if(!Array.isArray(a))throw new TypeError("missing iceCandidates");if("object"!=typeof s)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(p&&"object"!=typeof p)throw new TypeError("if given, appData must be an object");const f=new h.Transport({direction:t,id:r,iceParameters:n,iceCandidates:a,dtlsParameters:s,sctpParameters:i,iceServers:o,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:u,appData:p,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",f),f}}},3170:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const n=r(4019),a=new(r(9397).Logger)("EnhancedEventEmitter");class s extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return super.emit(e,...r)}safeEmit(e){const t=super.listenerCount(e);try{for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return super.emit(e,...n)}catch(r){return a.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,r),Boolean(t)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}t.EnhancedEventEmitter=s},9397:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=(s=r(1091))&&s.__esModule?s:{default:s},a="animation-client";var s;t.Logger=class{constructor(e){e?(this._debug=(0,n.default)(`${a}:${e}`),this._warn=(0,n.default)(`${a}:WARN:${e}`),this._error=(0,n.default)(`${a}:ERROR:${e}`)):(this._debug=(0,n.default)(a),this._warn=(0,n.default)(`${a}:WARN`),this._error=(0,n.default)(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},9836:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const i=r(9397),o=r(3170),c=r(2267),d=new i.Logger("Producer");class u extends o.EnhancedEventEmitter{constructor(e){let t=e.id,r=e.localId,n=e.rtpSender,a=e.track,s=e.rtpParameters,i=e.stopTracks,c=e.disableTrackOnPause,u=e.zeroRtpOnPause,p=e.appData;super(),this._closed=!1,this._observer=new o.EnhancedEventEmitter,d.debug("constructor()"),this._id=t,this._localId=r,this._rtpSender=n,this._track=a,this._kind=a.kind,this._rtpParameters=s,this._paused=!!c&&!a.enabled,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=c,this._zeroRtpOnPause=u,this._appData=p||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(d.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(d.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._closed){t.next=2;break}throw new c.InvalidStateError("closed");case 2:return t.abrupt("return",new Promise(((t,r)=>{e.safeEmit("@getstats",t,r)})));case 3:case"end":return t.stop()}}),t)})))()}pause(){d.debug("pause()"),this._closed?d.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@pause",e,t)})).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){d.debug("resume()"),this._closed?d.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise(((e,t)=>{this.safeEmit("@resume",e,t)})).catch((()=>{})),this._observer.safeEmit("resume"))}replaceTrack(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.track,d.debug("replaceTrack() [track:%o]",n),!t._closed){r.next=7;break}if(n&&t._stopTracks)try{n.stop()}catch(e){}throw new c.InvalidStateError("closed");case 7:if(!n||"ended"!==n.readyState){r.next=9;break}throw new c.InvalidStateError("track ended");case 9:if(n!==t._track){r.next=12;break}return d.debug("replaceTrack() | same track, ignored"),r.abrupt("return");case 12:return r.next=14,new Promise(((e,r)=>{t.safeEmit("@replacetrack",n,e,r)}));case 14:t.destroyTrack(),t._track=n,t._track&&t._disableTrackOnPause&&(t._paused?t._paused&&(t._track.enabled=!1):t._track.enabled=!0),t.handleTrack();case 18:case"end":return r.stop()}}),r)})))()}setMaxSpatialLayer(e){var t=this;return(0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t._closed){r.next=4;break}throw new c.InvalidStateError("closed");case 4:if("video"===t._kind){r.next=8;break}throw new c.UnsupportedError("not a video Producer");case 8:if("number"==typeof e){r.next=10;break}throw new TypeError("invalid spatialLayer");case 10:if(e!==t._maxSpatialLayer){r.next=12;break}return r.abrupt("return");case 12:return r.next=14,new Promise(((r,n)=>{t.safeEmit("@setmaxspatiallayer",e,r,n)})).catch((()=>{}));case 14:t._maxSpatialLayer=e;case 15:case"end":return r.stop()}}),r)})))()}setRtpEncodingParameters(e){var t=this;return(0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t._closed){r.next=4;break}throw new c.InvalidStateError("closed");case 4:if("object"==typeof e){r.next=6;break}throw new TypeError("invalid params");case 6:return r.next=8,new Promise(((r,n)=>{t.safeEmit("@setrtpencodingparameters",e,r,n)}));case 8:case"end":return r.stop()}}),r)})))()}onTrackEnded(){d.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=u},7139:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2066:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7167:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},d=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&c(t,e,r);return d(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const p=r(5822),l=(x=r(7521))&&x.__esModule?x:{default:x},f=r(9397),m=r(3170),h=r(2267),g=u(r(4813)),v=u(r(3394)),b=r(9836),y=r(1767),_=r(129),w=r(2236),S=new f.Logger("Transport");var x;class k{constructor(e){this.consumerOptions=e,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class R extends m.EnhancedEventEmitter{constructor(e){let t=e.direction,r=e.id,n=e.iceParameters,a=e.iceCandidates,s=e.dtlsParameters,i=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,l=e.appData,f=e.handlerFactory,h=e.extendedRtpCapabilities,v=e.canProduceByKind;super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new p.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new m.EnhancedEventEmitter,S.debug("constructor() [id:%s, direction:%s]",r,t),this._id=r,this._direction=t,this._extendedRtpCapabilities=h,this._canProduceByKind=v,this._maxSctpMessageSize=i?i.maxMessageSize:null,d=g.clone(d,{}),delete d.iceServers,delete d.iceTransportPolicy,delete d.bundlePolicy,delete d.rtcpMuxPolicy,delete d.sdpSemantics,this._handler=f(),this._handler.run({direction:t,iceParameters:n,iceCandidates:a,dtlsParameters:s,sctpParameters:i,iceServers:o,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:u,extendedRtpCapabilities:h}),this._appData=l||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){S.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();var e,t=i(this._producers.values());try{for(t.s();!(e=t.n()).done;)e.value.transportClosed()}catch(e){t.e(e)}finally{t.f()}this._producers.clear();var r,n=i(this._consumers.values());try{for(n.s();!(r=n.n()).done;)r.value.transportClosed()}catch(e){n.e(e)}finally{n.f()}this._consumers.clear();var a,s=i(this._dataProducers.values());try{for(s.s();!(a=s.n()).done;)a.value.transportClosed()}catch(e){s.e(e)}finally{s.f()}this._dataProducers.clear();var o,c=i(this._dataConsumers.values());try{for(c.s();!(o=c.n()).done;)o.value.transportClosed()}catch(e){c.e(e)}finally{c.f()}this._dataConsumers.clear(),this._observer.safeEmit("close")}}getStats(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._closed){t.next=2;break}throw new h.InvalidStateError("closed");case 2:return t.abrupt("return",e._handler.getTransportStats());case 3:case"end":return t.stop()}}),t)})))()}restartIce(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.iceParameters,S.debug("restartIce()"),!t._closed){r.next=6;break}throw new h.InvalidStateError("closed");case 6:if(n){r.next=8;break}throw new TypeError("missing iceParameters");case 8:return r.abrupt("return",t._awaitQueue.push((0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._handler.restartIce(n));case 1:case"end":return e.stop()}}),e)}))),"transport.restartIce()"));case 9:case"end":return r.stop()}}),r)})))()}updateIceServers(){var e=arguments,t=this;return(0,s.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=(e.length>0&&void 0!==e[0]?e[0]:{}).iceServers,S.debug("updateIceServers()"),!t._closed){r.next=6;break}throw new h.InvalidStateError("closed");case 6:if(Array.isArray(n)){r.next=8;break}throw new TypeError("missing iceServers");case 8:return r.abrupt("return",t._awaitQueue.push((0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._handler.updateIceServers(n));case 1:case"end":return e.stop()}}),e)}))),"transport.updateIceServers()"));case 9:case"end":return r.stop()}}),r)})))()}produce(){var e=arguments,t=this;return(0,s.default)(a.default.mark((function r(){var n,i,o,c,d,u,p,l,f,m,g,y,_;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=(n=e.length>0&&void 0!==e[0]?e[0]:{}).track,o=n.encodings,c=n.codecOptions,d=n.codec,u=n.stopTracks,p=void 0===u||u,l=n.disableTrackOnPause,f=void 0===l||l,m=n.zeroRtpOnPause,g=void 0!==m&&m,y=n.appData,_=void 0===y?{}:y,S.debug("produce() [track:%o]",i),!t._closed){r.next=6;break}throw new h.InvalidStateError("closed");case 6:if(i){r.next=10;break}throw new TypeError("missing track");case 10:if("send"===t._direction){r.next=14;break}throw new h.UnsupportedError("not a sending Transport");case 14:if(t._canProduceByKind[i.kind]){r.next=18;break}throw new h.UnsupportedError(`cannot produce ${i.kind}`);case 18:if("ended"!==i.readyState){r.next=22;break}throw new h.InvalidStateError("track ended");case 22:if(0!==t.listenerCount("connect")||"new"!==t._connectionState){r.next=26;break}throw new TypeError('no "connect" listener set into this transport');case 26:if(0!==t.listenerCount("produce")){r.next=30;break}throw new TypeError('no "produce" listener set into this transport');case 30:if(!_||"object"==typeof _){r.next=32;break}throw new TypeError("if given, appData must be an object");case 32:return r.abrupt("return",t._awaitQueue.push((0,s.default)(a.default.mark((function e(){var r,n,s,u,l,m,h,y;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||Array.isArray(o)){e.next=4;break}throw TypeError("encodings must be an array");case 4:o&&0===o.length?r=void 0:o&&(r=o.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));case 5:return e.next=7,t._handler.send({track:i,encodings:r,codecOptions:c,codec:d});case 7:return n=e.sent,s=n.localId,u=n.rtpParameters,l=n.rtpSender,e.prev=11,v.validateRtpParameters(u),e.next=15,new Promise(((e,r)=>{t.safeEmit("produce",{kind:i.kind,rtpParameters:u,appData:_},e,r)}));case 15:return m=e.sent,h=m.id,y=new b.Producer({id:h,localId:s,rtpSender:l,track:i,rtpParameters:u,stopTracks:p,disableTrackOnPause:f,zeroRtpOnPause:g,appData:_}),t._producers.set(y.id,y),t.handleProducer(y),t._observer.safeEmit("newproducer",y),e.abrupt("return",y);case 24:throw e.prev=24,e.t0=e.catch(11),t._handler.stopSending(s).catch((()=>{})),e.t0;case 28:case"end":return e.stop()}}),e,null,[[11,24]])}))),"transport.produce()").catch((e=>{if(p)try{i.stop()}catch(e){}throw e})));case 33:case"end":return r.stop()}}),r)})))()}consume(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.id,s=e.producerId,i=e.kind,o=e.rtpParameters,c=e.streamId,d=e.appData,u=void 0===d?{}:d,S.debug("consume()"),o=g.clone(o,void 0),!t._closed){r.next=7;break}throw new h.InvalidStateError("closed");case 7:if("recv"===t._direction){r.next=11;break}throw new h.UnsupportedError("not a receiving Transport");case 11:if("string"==typeof n){r.next=15;break}throw new TypeError("missing id");case 15:if("string"==typeof s){r.next=19;break}throw new TypeError("missing producerId");case 19:if("audio"===i||"video"===i){r.next=23;break}throw new TypeError(`invalid kind '${i}'`);case 23:if(0!==t.listenerCount("connect")||"new"!==t._connectionState){r.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!u||"object"==typeof u){r.next=29;break}throw new TypeError("if given, appData must be an object");case 29:if(v.canReceive(o,t._extendedRtpCapabilities)){r.next=32;break}throw new h.UnsupportedError("cannot consume this Producer");case 32:return p=new k({id:n,producerId:s,kind:i,rtpParameters:o,streamId:c,appData:u}),t._pendingConsumerTasks.push(p),(0,l.default)((()=>{t._closed||!1===t._consumerCreationInProgress&&t.createPendingConsumers()})),r.abrupt("return",p.promise);case 36:case"end":return r.stop()}}),r)})))()}produceData(){var e=arguments,t=this;return(0,s.default)(a.default.mark((function r(){var n,i,o,c,d,u,p,l,f,m,g;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=(n=e.length>0&&void 0!==e[0]?e[0]:{}).ordered,o=void 0===i||i,c=n.maxPacketLifeTime,d=n.maxRetransmits,u=n.label,p=void 0===u?"":u,l=n.protocol,f=void 0===l?"":l,m=n.appData,g=void 0===m?{}:m,S.debug("produceData()"),!t._closed){r.next=6;break}throw new h.InvalidStateError("closed");case 6:if("send"===t._direction){r.next=10;break}throw new h.UnsupportedError("not a sending Transport");case 10:if(t._maxSctpMessageSize){r.next=14;break}throw new h.UnsupportedError("SCTP not enabled by remote Transport");case 14:if(0!==t.listenerCount("connect")||"new"!==t._connectionState){r.next=18;break}throw new TypeError('no "connect" listener set into this transport');case 18:if(0!==t.listenerCount("producedata")){r.next=22;break}throw new TypeError('no "producedata" listener set into this transport');case 22:if(!g||"object"==typeof g){r.next=24;break}throw new TypeError("if given, appData must be an object");case 24:return(c||d)&&(o=!1),r.abrupt("return",t._awaitQueue.push((0,s.default)(a.default.mark((function e(){var r,n,s,i,u,l;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._handler.sendDataChannel({ordered:o,maxPacketLifeTime:c,maxRetransmits:d,label:p,protocol:f});case 2:return r=e.sent,n=r.dataChannel,s=r.sctpStreamParameters,v.validateSctpStreamParameters(s),e.next=8,new Promise(((e,r)=>{t.safeEmit("producedata",{sctpStreamParameters:s,label:p,protocol:f,appData:g},e,r)}));case 8:return i=e.sent,u=i.id,l=new _.DataProducer({id:u,dataChannel:n,sctpStreamParameters:s,appData:g}),t._dataProducers.set(l.id,l),t.handleDataProducer(l),t._observer.safeEmit("newdataproducer",l),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)}))),"transport.produceData()"));case 26:case"end":return r.stop()}}),r)})))()}consumeData(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n,i,o,c,d,u,p,l,f;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.id,i=e.dataProducerId,o=e.sctpStreamParameters,c=e.label,d=void 0===c?"":c,u=e.protocol,p=void 0===u?"":u,l=e.appData,f=void 0===l?{}:l,S.debug("consumeData()"),o=g.clone(o,void 0),!t._closed){r.next=7;break}throw new h.InvalidStateError("closed");case 7:if("recv"===t._direction){r.next=11;break}throw new h.UnsupportedError("not a receiving Transport");case 11:if(t._maxSctpMessageSize){r.next=15;break}throw new h.UnsupportedError("SCTP not enabled by remote Transport");case 15:if("string"==typeof n){r.next=19;break}throw new TypeError("missing id");case 19:if("string"==typeof i){r.next=23;break}throw new TypeError("missing dataProducerId");case 23:if(0!==t.listenerCount("connect")||"new"!==t._connectionState){r.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!f||"object"==typeof f){r.next=29;break}throw new TypeError("if given, appData must be an object");case 29:return v.validateSctpStreamParameters(o),r.abrupt("return",t._awaitQueue.push((0,s.default)(a.default.mark((function e(){var r,s,c;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._handler.receiveDataChannel({sctpStreamParameters:o,label:d,protocol:p});case 2:return r=e.sent,s=r.dataChannel,c=new w.DataConsumer({id:n,dataProducerId:i,dataChannel:s,sctpStreamParameters:o,appData:f}),t._dataConsumers.set(c.id,c),t.handleDataConsumer(c),t._observer.safeEmit("newdataconsumer",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)}))),"transport.consumeData()"));case 31:case"end":return r.stop()}}),r)})))()}createPendingConsumers(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._consumerCreationInProgress=!0,e._awaitQueue.push((0,s.default)(a.default.mark((function t(){var r,n,s,o,c,d,u,p,l,f,m,h,g,b,_,w,x,k,R,P,C,T,D,O;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingConsumerTasks.length){t.next=3;break}return S.debug("createPendingConsumers() | there is no Consumer to be created"),t.abrupt("return");case 3:for(r=[...e._pendingConsumerTasks],e._pendingConsumerTasks=[],n=void 0,s=[],o=0,c=r;o<c.length;o++)d=c[o],u=d.consumerOptions,p=u.id,l=u.kind,f=u.rtpParameters,m=u.streamId,s.push({trackId:p,kind:l,rtpParameters:f,streamId:m});return t.prev=8,t.next=11,e._handler.receive(s);case 11:for(h=t.sent,g=0;g<h.length;++g)d=r[g],b=h[g],_=d.consumerOptions,p=_.id,w=_.producerId,l=_.kind,f=_.rtpParameters,x=_.appData,k=b.localId,R=b.rtpReceiver,P=b.track,C=new y.Consumer({id:p,localId:k,producerId:w,rtpReceiver:R,track:P,rtpParameters:f,appData:x}),e._consumers.set(C.id,C),e.handleConsumer(C),e._probatorConsumerCreated||n||"video"!==l||(n=C),e._observer.safeEmit("newconsumer",C),d.resolve(C);t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),T=i(r);try{for(T.s();!(D=T.n()).done;)(d=D.value).reject(t.t0)}catch(e){T.e(e)}finally{T.f()}case 19:if(!n){t.next=31;break}return t.prev=20,O=v.generateProbatorRtpParameters(n.rtpParameters),t.next=24,e._handler.receive([{trackId:"probator",kind:"video",rtpParameters:O}]);case 24:S.debug("createPendingConsumers() | Consumer for RTP probation created"),e._probatorConsumerCreated=!0,t.next=31;break;case 28:t.prev=28,t.t1=t.catch(20),S.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",t.t1);case 31:case"end":return t.stop()}}),t,null,[[8,15],[20,28]])}))),"transport.createPendingConsumers()").then((()=>{e._consumerCreationInProgress=!1,e._pendingConsumerTasks.length>0&&e.createPendingConsumers()})).catch((()=>{}));case 2:case"end":return t.stop()}}),t)})))()}pausePendingConsumers(){var e=this;this._consumerPauseInProgress=!0,this._awaitQueue.push((0,s.default)(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingPauseConsumers.size){t.next=3;break}return S.debug("pausePendingConsumers() | there is no Consumer to be paused"),t.abrupt("return");case 3:return r=Array.from(e._pendingPauseConsumers.values()),e._pendingPauseConsumers.clear(),t.prev=5,n=r.map((e=>e.localId)),t.next=9,e._handler.pauseReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),S.error("pausePendingConsumers() | failed to pause Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.pausePendingConsumers").then((()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()})).catch((()=>{}))}resumePendingConsumers(){var e=this;this._consumerResumeInProgress=!0,this._awaitQueue.push((0,s.default)(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingResumeConsumers.size){t.next=3;break}return S.debug("resumePendingConsumers() | there is no Consumer to be resumed"),t.abrupt("return");case 3:return r=Array.from(e._pendingResumeConsumers.values()),e._pendingResumeConsumers.clear(),t.prev=5,n=r.map((e=>e.localId)),t.next=9,e._handler.resumeReceiving(n);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),S.error("resumePendingConsumers() | failed to resume Consumers:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[5,11]])}))),"transport.resumePendingConsumers").then((()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()})).catch((()=>{}))}closePendingConsumers(){var e=this;this._consumerCloseInProgress=!0,this._awaitQueue.push((0,s.default)(a.default.mark((function t(){var r;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e._pendingCloseConsumers.size){t.next=3;break}return S.debug("closePendingConsumers() | there is no Consumer to be closed"),t.abrupt("return");case 3:return r=Array.from(e._pendingCloseConsumers.values()),e._pendingCloseConsumers.clear(),t.prev=5,t.next=8,e._handler.stopReceiving(r.map((e=>e.localId)));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),S.error("closePendingConsumers() | failed to close Consumers:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[5,10]])}))),"transport.closePendingConsumers").then((()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()})).catch((()=>{}))}handleHandler(){const e=this._handler;e.on("@connect",((e,t,r)=>{let n=e.dtlsParameters;this._closed?r(new h.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:n},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(S.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}handleProducer(e){var t=this;e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @close event").catch((e=>S.warn("producer.close() failed:%o",e)))})),e.on("@pause",((r,n)=>{this._awaitQueue.push((0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.pauseSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @pause event").then(r).catch(n)})),e.on("@resume",((r,n)=>{this._awaitQueue.push((0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.resumeSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @resume event").then(r).catch(n)})),e.on("@replacetrack",((r,n,i)=>{this._awaitQueue.push((0,s.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.replaceTrack(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @replacetrack event").then(n).catch(i)})),e.on("@setmaxspatiallayer",((r,n,i)=>{this._awaitQueue.push((0,s.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setMaxSpatialLayer(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @setmaxspatiallayer event").then(n).catch(i)})),e.on("@setrtpencodingparameters",((r,n,i)=>{this._awaitQueue.push((0,s.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setRtpEncodingParameters(e.localId,r));case 1:case"end":return n.stop()}}),n)}))),"producer @setrtpencodingparameters event").then(n).catch(i)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new h.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),this._closed||(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())})),e.on("@pause",(()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),(0,l.default)((()=>{this._closed||!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}))})),e.on("@resume",(()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),(0,l.default)((()=>{this._closed||!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new h.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}t.Transport=R},2267:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}}t.UnsupportedError=r;class n extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}t.InvalidStateError=n},1058:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(476)),_=f(r(9572)),w=r(4703),S=r(4128),x=r(3555),k=new h.Logger("Chrome111"),R={OS:1024,MIS:1024};class P extends w.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),_.addNackSuppportForOpus(s),e.abrupt("return",s);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:R});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;k.debug("run()"),this._direction=t,this._remoteSdp=new S.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:k.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,S,R,P,C,T,D,O,M,E,j,I;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),s&&s.length>1){s.forEach(((e,t)=>{e.rid=`r${t}`})),u=1,p=1,l=o(s);try{for(l.s();!(f=l.n()).done;)h=f.value,(_=h.scalabilityMode?(0,x.parse)(h.scalabilityMode).temporalLayers:3)>p&&(p=_)}catch(e){l.e(e)}finally{l.f()}w=o(s);try{for(w.s();!(S=w.n()).done;)(h=S.value).rid="r"+u++,h.scalabilityMode=`L1T${p}`}catch(e){w.e(e)}finally{w.f()}}return(R=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(R.codecs,c),(P=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(P.codecs,c),C=t._remoteSdp.getNextMediaSectionIdx(),T=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream],sendEncodings:s}),r.next=12,t._pc.createOffer();case 12:if(D=r.sent,O=m.parse(D.sdp),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:O});case 17:return k.debug("send() | calling pc.setLocalDescription() [offer:%o]",D),r.next=20,t._pc.setLocalDescription(D);case 20:return M=T.mid,R.mid=M,O=m.parse(t._pc.localDescription.sdp),E=O.media[C.idx],R.rtcp.cname=b.getCname({offerMediaObject:E}),s?1===s.length?(j=y.getRtpEncodings({offerMediaObject:E}),Object.assign(j[0],s[0]),R.encodings=j):R.encodings=s:R.encodings=y.getRtpEncodings({offerMediaObject:E}),t._remoteSdp.send({offerMediaObject:E,reuseMid:C.reuseMid,offerRtpParameters:R,answerRtpParameters:P,codecOptions:i,extmapAllowMixed:!0}),I={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),r.next=31,t._pc.setRemoteDescription(I);case 31:return t._mapMidTransceiver.set(M,T),r.abrupt("return",{localId:M,rtpParameters:R,rtpSender:T.sender});case 33:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch(e){}return r.next=11,t._pc.createOffer();case 11:return s=r.sent,k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=15,t._pc.setLocalDescription(s);case 15:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=19,t._pc.setRemoteDescription(i);case 19:t._mapMidTransceiver.delete(e);case 20:case"end":return r.stop()}}),r)})))()}pauseSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("pauseSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="inactive",t._remoteSdp.pauseMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}resumeSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("resumeSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e),t._remoteSdp.resumeSendingMediaSection(e),n){r.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return n.direction="sendonly",r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},k.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%R.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,S,x,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,f=u.rtpParameters,h=u.streamId,k.debug("receive() [trackId:%s, kind:%s]",p,l),g=f.mid||String(t._mapMidTransceiver.size),i.set(p,g),t._remoteSdp.receive({mid:g,kind:l,offerRtpParameters:f,streamId:h||f.rtcp.cname,trackId:p})}catch(e){c.e(e)}finally{c.f()}return v={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),r.next=9,t._pc.setRemoteDescription(v);case 9:return r.next=11,t._pc.createAnswer();case 11:y=r.sent,_=m.parse(y.sdp),w=o(e);try{for(w.s();!(S=w.n()).done;)u=S.value,p=u.trackId,f=u.rtpParameters,g=i.get(p),x=_.media.find((e=>String(e.mid)===g)),b.applyCodecParameters({offerRtpParameters:f,answerMediaObject:x})}catch(e){w.e(e)}finally{w.f()}if(y={type:"answer",sdp:m.write(_)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});case 19:return k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),r.next=22,t._pc.setLocalDescription(y);case 22:R=o(e),r.prev=23,R.s();case 25:if((P=R.n()).done){r.next=38;break}if(u=P.value,p=u.trackId,g=i.get(p),C=t._pc.getTransceivers().find((e=>e.mid===g))){r.next=34;break}throw new Error("new RTCRtpTransceiver not found");case 34:t._mapMidTransceiver.set(g,C),s.push({localId:g,track:C.receiver.track,rtpReceiver:C.receiver});case 36:r.next=25;break;case 38:r.next=43;break;case 40:r.prev=40,r.t0=r.catch(23),R.e(r.t0);case 43:return r.prev=43,R.f(),r.finish(43);case 46:return r.abrupt("return",s);case 47:case"end":return r.stop()}}),r,null,[[23,40,43,46]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,k.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("pauseReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="inactive",t._remoteSdp.pauseMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}resumeReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("resumeReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="recvonly",t._remoteSdp.resumeReceivingMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmits:p,protocol:i},k.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),h={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome111=P},4588:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var u=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},p=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&u(t,e,r);return p(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;const f=l(r(372)),m=r(9397),h=r(2267),g=l(r(4813)),v=l(r(3394)),b=l(r(1078)),y=l(r(3965)),_=r(4703),w=r(4128),S=new m.Logger("Chrome55"),x={OS:1024,MIS:1024};class k extends _.HandlerInterface{static createFactory(){return()=>new k}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(S.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=f.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,i=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,u=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;S.debug("run()"),this._direction=t,this._remoteSdp=new w.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",l),video:v.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",l),video:v.getSendingRemoteRtpParameters("video",l)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:o||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},u),p),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:S.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(S.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,m,h,_,w,x,k,R;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),c&&S.warn("send() | codec selection is not available in %s handler",t.name),t._sendStream.addTrack(n),t._pc.addStream(t._sendStream),r.next=8,t._pc.createOffer();case 8:if(u=r.sent,p=f.parse(u.sdp),(m=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(m.codecs),(h=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(h.codecs),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 17:return"video"===n.kind&&s&&s.length>1&&(S.debug("send() | enabling simulcast"),p=f.parse(u.sdp),l=p.media.find((e=>"video"===e.type)),y.addLegacySimulcast({offerMediaObject:l,track:n,numStreams:s.length}),u={type:"offer",sdp:f.write(p)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),r.next=21,t._pc.setLocalDescription(u);case 21:if(p=f.parse(t._pc.localDescription.sdp),l=p.media.find((e=>e.type===n.kind)),m.rtcp.cname=b.getCname({offerMediaObject:l}),m.encodings=y.getRtpEncodings({offerMediaObject:l,track:n}),s)for(_=0;_<m.encodings.length;++_)s[_]&&Object.assign(m.encodings[_],s[_]);if(m.encodings.length>1&&"video/vp8"===m.codecs[0].mimeType.toLowerCase()){w=o(m.encodings);try{for(w.s();!(x=w.n()).done;)x.value.scalabilityMode="L1T3"}catch(e){w.e(e)}finally{w.f()}}return t._remoteSdp.send({offerMediaObject:l,offerRtpParameters:m,answerRtpParameters:h,codecOptions:i}),k={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),r.next=32,t._pc.setRemoteDescription(k);case 32:return R=String(t._nextSendLocalId),t._nextSendLocalId++,t._mapSendLocalIdTrack.set(R,n),r.abrupt("return",{localId:R,rtpParameters:m});case 36:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),S.debug("stopSending() [localId:%s]",e),n=t._mapSendLocalIdTrack.get(e)){r.next=5;break}throw new Error("track not found");case 5:return t._mapSendLocalIdTrack.delete(e),t._sendStream.removeTrack(n),t._pc.addStream(t._sendStream),r.next=10,t._pc.createOffer();case 10:return s=r.sent,S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.prev=12,r.next=15,t._pc.setLocalDescription(s);case 15:r.next=23;break;case 17:if(r.prev=17,r.t0=r.catch(12),0!==t._sendStream.getTracks().length){r.next=22;break}return S.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.t0.toString()),r.abrupt("return");case 22:throw r.t0;case 23:if("stable"!==t._pc.signalingState){r.next=25;break}return r.abrupt("return");case 25:return i={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=29,t._pc.setRemoteDescription(i);case 29:case"end":return r.stop()}}),r,null,[[12,17]])})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}setMaxSpatialLayer(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError(" not implemented");case 1:case"end":return e.stop()}}),e)})))()}setRtpEncodingParameters(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})))()}getSenderStats(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,m,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:i,protocol:c},S.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%x.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,m=f.parse(l.sdp),h=m.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:m});case 15:return S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,m,h,g,v,y,_,w,x,k,R,P,C,T;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=o(e);try{for(i.s();!(c=i.n()).done;)d=c.value,u=d.trackId,p=d.kind,l=d.rtpParameters,m=d.streamId,S.debug("receive() [trackId:%s, kind:%s]",u,p),h=p,t._remoteSdp.receive({mid:h,kind:p,offerRtpParameters:l,streamId:m||l.rtcp.cname,trackId:u})}catch(e){i.e(e)}finally{i.f()}return g={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),r.next=8,t._pc.setRemoteDescription(g);case 8:return r.next=10,t._pc.createAnswer();case 10:v=r.sent,y=f.parse(v.sdp),_=o(e);try{for(_.s();!(w=_.n()).done;)d=w.value,p=d.kind,l=d.rtpParameters,h=p,x=y.media.find((e=>String(e.mid)===h)),b.applyCodecParameters({offerRtpParameters:l,answerMediaObject:x})}catch(e){_.e(e)}finally{_.f()}if(v={type:"answer",sdp:f.write(y)},t._transportReady){r.next=18;break}return r.next=18,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:y});case 18:return S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),r.next=21,t._pc.setLocalDescription(v);case 21:k=o(e),r.prev=22,k.s();case 24:if((R=k.n()).done){r.next=38;break}if(d=R.value,p=d.kind,u=d.trackId,l=d.rtpParameters,h=p,P=u,m=d.streamId||l.rtcp.cname,C=t._pc.getRemoteStreams().find((e=>e.id===m)),T=C.getTrackById(P)){r.next=34;break}throw new Error("remote track not found");case 34:t._mapRecvLocalIdInfo.set(P,{mid:h,rtpParameters:l}),s.push({localId:P,track:T});case 36:r.next=24;break;case 38:r.next=43;break;case 40:r.prev=40,r.t0=r.catch(22),k.e(r.t0);case 43:return r.prev=43,k.f(),r.finish(43);case 46:return r.abrupt("return",s);case 47:case"end":return r.stop()}}),r,null,[[22,40,43,46]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e);try{for(n.s();!(s=n.n()).done;)i=s.value,S.debug("stopReceiving() [localId:%s]",i),c=t._mapRecvLocalIdInfo.get(i)||{},d=c.mid,u=c.rtpParameters,t._mapRecvLocalIdInfo.delete(i),t._remoteSdp.planBStopReceiving({mid:d,offerRtpParameters:u})}catch(e){n.e(e)}finally{n.f()}return p={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),r.next=7,t._pc.setRemoteDescription(p);case 7:return r.next=9,t._pc.createAnswer();case 9:return l=r.sent,S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),r.next=13,t._pc.setLocalDescription(l);case 13:case"end":return r.stop()}}),r)})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}getReceiverStats(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,m,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},S.debug("receiveDataChannel() [options:%o]",l),m=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),h={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=f.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:m});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=f.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=k},6811:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(3965)),_=r(4703),w=r(4128),S=new h.Logger("Chrome67"),x={OS:1024,MIS:1024};class k extends _.HandlerInterface{static createFactory(){return()=>new k}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(S.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;S.debug("run()"),this._direction=t,this._remoteSdp=new w.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:S.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(S.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,x,k,R,P;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),c&&S.warn("send() | codec selection is not available in %s handler",t.name),t._sendStream.addTrack(n),t._pc.addTrack(n,t._sendStream),r.next=8,t._pc.createOffer();case 8:if(u=r.sent,p=m.parse(u.sdp),(f=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(f.codecs),(h=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(h.codecs),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 17:return"video"===n.kind&&s&&s.length>1&&(S.debug("send() | enabling simulcast"),p=m.parse(u.sdp),l=p.media.find((e=>"video"===e.type)),y.addLegacySimulcast({offerMediaObject:l,track:n,numStreams:s.length}),u={type:"offer",sdp:m.write(p)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),r.next=21,t._pc.setLocalDescription(u);case 21:if(p=m.parse(t._pc.localDescription.sdp),l=p.media.find((e=>e.type===n.kind)),f.rtcp.cname=b.getCname({offerMediaObject:l}),f.encodings=y.getRtpEncodings({offerMediaObject:l,track:n}),s)for(_=0;_<f.encodings.length;++_)s[_]&&Object.assign(f.encodings[_],s[_]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){w=o(f.encodings);try{for(w.s();!(x=w.n()).done;)x.value.scalabilityMode="L1T3"}catch(e){w.e(e)}finally{w.f()}}return t._remoteSdp.send({offerMediaObject:l,offerRtpParameters:f,answerRtpParameters:h,codecOptions:i}),k={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),r.next=32,t._pc.setRemoteDescription(k);case 32:return R=String(t._nextSendLocalId),t._nextSendLocalId++,P=t._pc.getSenders().find((e=>e.track===n)),t._mapSendLocalIdRtpSender.set(R,P),r.abrupt("return",{localId:R,rtpParameters:f,rtpSender:P});case 37:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),S.debug("stopSending() [localId:%s]",e),n=t._mapSendLocalIdRtpSender.get(e)){r.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return t._pc.removeTrack(n),n.track&&t._sendStream.removeTrack(n.track),t._mapSendLocalIdRtpSender.delete(e),r.next=10,t._pc.createOffer();case 10:return s=r.sent,S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.prev=12,r.next=15,t._pc.setLocalDescription(s);case 15:r.next=23;break;case 17:if(r.prev=17,r.t0=r.catch(12),0!==t._sendStream.getTracks().length){r.next=22;break}return S.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.t0.toString()),r.abrupt("return");case 22:throw r.t0;case 23:if("stable"!==t._pc.signalingState){r.next=25;break}return r.abrupt("return");case 25:return i={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=29,t._pc.setRemoteDescription(i);case 29:case"end":return r.stop()}}),r,null,[[12,17]])})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):S.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=s.track,n.next=8,s.replaceTrack(t);case 8:i&&r._sendStream.removeTrack(i),t&&r._sendStream.addTrack(t);case 10:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=s.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.setParameters(i);case 9:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=s.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.setParameters(i);case 9:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapSendLocalIdRtpSender.get(e)){r.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.abrupt("return",n.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:i,protocol:c},S.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%x.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,x,k,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=o(e);try{for(i.s();!(c=i.n()).done;)d=c.value,u=d.trackId,p=d.kind,l=d.rtpParameters,f=d.streamId,S.debug("receive() [trackId:%s, kind:%s]",u,p),h=p,t._remoteSdp.receive({mid:h,kind:p,offerRtpParameters:l,streamId:f||l.rtcp.cname,trackId:u})}catch(e){i.e(e)}finally{i.f()}return g={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),r.next=8,t._pc.setRemoteDescription(g);case 8:return r.next=10,t._pc.createAnswer();case 10:v=r.sent,y=m.parse(v.sdp),_=o(e);try{for(_.s();!(w=_.n()).done;)d=w.value,p=d.kind,l=d.rtpParameters,h=p,x=y.media.find((e=>String(e.mid)===h)),b.applyCodecParameters({offerRtpParameters:l,answerMediaObject:x})}catch(e){_.e(e)}finally{_.f()}if(v={type:"answer",sdp:m.write(y)},t._transportReady){r.next=18;break}return r.next=18,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:y});case 18:return S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),r.next=21,t._pc.setLocalDescription(v);case 21:k=o(e),r.prev=22,k.s();case 24:if((R=k.n()).done){r.next=36;break}if(d=R.value,p=d.kind,u=d.trackId,l=d.rtpParameters,P=u,h=p,C=t._pc.getReceivers().find((e=>e.track&&e.track.id===P))){r.next=32;break}throw new Error("new RTCRtpReceiver not");case 32:t._mapRecvLocalIdInfo.set(P,{mid:h,rtpParameters:l,rtpReceiver:C}),s.push({localId:P,track:C.track,rtpReceiver:C});case 34:r.next=24;break;case 36:r.next=41;break;case 38:r.prev=38,r.t0=r.catch(22),k.e(r.t0);case 41:return r.prev=41,k.f(),r.finish(41);case 44:return r.abrupt("return",s);case 45:case"end":return r.stop()}}),r,null,[[22,38,41,44]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e);try{for(n.s();!(s=n.n()).done;)i=s.value,S.debug("stopReceiving() [localId:%s]",i),c=t._mapRecvLocalIdInfo.get(i)||{},d=c.mid,u=c.rtpParameters,t._mapRecvLocalIdInfo.delete(i),t._remoteSdp.planBStopReceiving({mid:d,offerRtpParameters:u})}catch(e){n.e(e)}finally{n.f()}return p={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),r.next=7,t._pc.setRemoteDescription(p);case 7:return r.next=9,t._pc.createAnswer();case 9:return l=r.sent,S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),r.next=13,t._pc.setLocalDescription(l);case 13:case"end":return r.stop()}}),r)})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapRecvLocalIdInfo.get(e)||{},s=n.rtpReceiver){r.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return r.abrupt("return",s.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},S.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),h={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=k},5942:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(476)),_=r(4703),w=r(4128),S=r(3555),x=new h.Logger("Chrome70"),k={OS:1024,MIS:1024};class R extends _.HandlerInterface{static createFactory(){return()=>new R}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(x.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",s);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:k});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;x.debug("run()"),this._direction=t,this._remoteSdp=new w.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(x.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:x.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(x.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,k,R,P,C,T,D,O,M,E,j;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),(u=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(u.codecs,c),(p=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(p.codecs,c),l=t._remoteSdp.getNextMediaSectionIdx(),f=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream]}),r.next=11,t._pc.createOffer();case 11:if(h=r.sent,_=m.parse(h.sdp),t._transportReady){r.next=16;break}return r.next=16,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:_});case 16:return s&&s.length>1&&(x.debug("send() | enabling legacy simulcast"),_=m.parse(h.sdp),w=_.media[l.idx],y.addLegacySimulcast({offerMediaObject:w,numStreams:s.length}),h={type:"offer",sdp:m.write(_)}),k=!1,R=(0,S.parse)((s||[{}])[0].scalabilityMode),s&&1===s.length&&R.spatialLayers>1&&"video/vp9"===u.codecs[0].mimeType.toLowerCase()&&(x.debug("send() | enabling legacy simulcast for VP9 SVC"),k=!0,_=m.parse(h.sdp),w=_.media[l.idx],y.addLegacySimulcast({offerMediaObject:w,numStreams:R.spatialLayers}),h={type:"offer",sdp:m.write(_)}),x.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),r.next=23,t._pc.setLocalDescription(h);case 23:if(!s){r.next=38;break}x.debug("send() | applying given encodings"),P=f.sender.getParameters(),C=0;case 27:if(!(C<(P.encodings||[]).length)){r.next=36;break}if(T=P.encodings[C],D=s[C]){r.next=32;break}return r.abrupt("break",36);case 32:P.encodings[C]=Object.assign(T,D);case 33:++C,r.next=27;break;case 36:return r.next=38,f.sender.setParameters(P);case 38:if(O=f.mid,u.mid=O,_=m.parse(t._pc.localDescription.sdp),w=_.media[l.idx],u.rtcp.cname=b.getCname({offerMediaObject:w}),u.encodings=y.getRtpEncodings({offerMediaObject:w}),s)for(C=0;C<u.encodings.length;++C)s[C]&&Object.assign(u.encodings[C],s[C]);if(k&&(u.encodings=[u.encodings[0]]),u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase())){M=o(u.encodings);try{for(M.s();!(E=M.n()).done;)(T=E.value).scalabilityMode="L1T3"}catch(e){M.e(e)}finally{M.f()}}return t._remoteSdp.send({offerMediaObject:w,reuseMid:l.reuseMid,offerRtpParameters:u,answerRtpParameters:p,codecOptions:i}),j={type:"answer",sdp:t._remoteSdp.getSdp()},x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",j),r.next=52,t._pc.setRemoteDescription(j);case 52:return t._mapMidTransceiver.set(O,f),r.abrupt("return",{localId:O,rtpParameters:u,rtpSender:f.sender});case 54:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),x.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch(e){}return r.next=11,t._pc.createOffer();case 11:return s=r.sent,x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=15,t._pc.setLocalDescription(s);case 15:return i={type:"answer",sdp:t._remoteSdp.getSdp()},x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=19,t._pc.setRemoteDescription(i);case 19:t._mapMidTransceiver.delete(e);case 20:case"end":return r.stop()}}),r)})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?x.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):x.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,x.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},x.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,x.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},x.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:i,protocol:c},x.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%k.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,S,k,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,f=u.rtpParameters,h=u.streamId,x.debug("receive() [trackId:%s, kind:%s]",p,l),g=f.mid||String(t._mapMidTransceiver.size),i.set(p,g),t._remoteSdp.receive({mid:g,kind:l,offerRtpParameters:f,streamId:h||f.rtcp.cname,trackId:p})}catch(e){c.e(e)}finally{c.f()}return v={type:"offer",sdp:t._remoteSdp.getSdp()},x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),r.next=9,t._pc.setRemoteDescription(v);case 9:return r.next=11,t._pc.createAnswer();case 11:y=r.sent,_=m.parse(y.sdp),w=o(e);try{for(w.s();!(S=w.n()).done;)u=S.value,p=u.trackId,f=u.rtpParameters,g=i.get(p),k=_.media.find((e=>String(e.mid)===g)),b.applyCodecParameters({offerRtpParameters:f,answerMediaObject:k})}catch(e){w.e(e)}finally{w.f()}if(y={type:"answer",sdp:m.write(_)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});case 19:return x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),r.next=22,t._pc.setLocalDescription(y);case 22:R=o(e),r.prev=23,R.s();case 25:if((P=R.n()).done){r.next=36;break}if(u=P.value,p=u.trackId,g=i.get(p),C=t._pc.getTransceivers().find((e=>e.mid===g))){r.next=32;break}throw new Error("new RTCRtpTransceiver not found");case 32:t._mapMidTransceiver.set(g,C),s.push({localId:g,track:C.receiver.track,rtpReceiver:C.receiver});case 34:r.next=25;break;case 36:r.next=41;break;case 38:r.prev=38,r.t0=r.catch(23),R.e(r.t0);case 41:return r.prev=41,R.f(),r.finish(41);case 44:return r.abrupt("return",s);case 45:case"end":return r.stop()}}),r,null,[[23,38,41,44]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,x.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},x.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),h={type:"offer",sdp:t._remoteSdp.getSdp()},x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=R},4415:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(476)),_=f(r(9572)),w=r(4703),S=r(4128),x=r(3555),k=new h.Logger("Chrome74"),R={OS:1024,MIS:1024};class P extends w.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),_.addNackSuppportForOpus(s),e.abrupt("return",s);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:R});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;k.debug("run()"),this._direction=t,this._remoteSdp=new S.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:k.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,S,R,P,C,T,D,O,M;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),s&&s.length>1&&s.forEach(((e,t)=>{e.rid=`r${t}`})),(u=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(u.codecs,c),(p=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(p.codecs,c),l=t._remoteSdp.getNextMediaSectionIdx(),f=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream],sendEncodings:s}),r.next=12,t._pc.createOffer();case 12:if(h=r.sent,_=m.parse(h.sdp),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:_});case 17:return S=!1,R=(0,x.parse)((s||[{}])[0].scalabilityMode),s&&1===s.length&&R.spatialLayers>1&&"video/vp9"===u.codecs[0].mimeType.toLowerCase()&&(k.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,_=m.parse(h.sdp),w=_.media[l.idx],y.addLegacySimulcast({offerMediaObject:w,numStreams:R.spatialLayers}),h={type:"offer",sdp:m.write(_)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),r.next=23,t._pc.setLocalDescription(h);case 23:if(P=f.mid,u.mid=P,_=m.parse(t._pc.localDescription.sdp),w=_.media[l.idx],u.rtcp.cname=b.getCname({offerMediaObject:w}),s?1===s.length?(C=y.getRtpEncodings({offerMediaObject:w}),Object.assign(C[0],s[0]),S&&(C=[C[0]]),u.encodings=C):u.encodings=s:u.encodings=y.getRtpEncodings({offerMediaObject:w}),u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase())){T=o(u.encodings);try{for(T.s();!(D=T.n()).done;)(O=D.value).scalabilityMode?O.scalabilityMode=`L1T${R.temporalLayers}`:O.scalabilityMode="L1T3"}catch(e){T.e(e)}finally{T.f()}}return t._remoteSdp.send({offerMediaObject:w,reuseMid:l.reuseMid,offerRtpParameters:u,answerRtpParameters:p,codecOptions:i,extmapAllowMixed:!0}),M={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),r.next=35,t._pc.setRemoteDescription(M);case 35:return t._mapMidTransceiver.set(P,f),r.abrupt("return",{localId:P,rtpParameters:u,rtpSender:f.sender});case 37:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch(e){}return r.next=11,t._pc.createOffer();case 11:return s=r.sent,k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=15,t._pc.setLocalDescription(s);case 15:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=19,t._pc.setRemoteDescription(i);case 19:t._mapMidTransceiver.delete(e);case 20:case"end":return r.stop()}}),r)})))()}pauseSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("pauseSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="inactive",t._remoteSdp.pauseMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}resumeSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("resumeSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e),t._remoteSdp.resumeSendingMediaSection(e),n){r.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return n.direction="sendonly",r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},k.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%R.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,S,x,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,f=u.rtpParameters,h=u.streamId,k.debug("receive() [trackId:%s, kind:%s]",p,l),g=f.mid||String(t._mapMidTransceiver.size),i.set(p,g),t._remoteSdp.receive({mid:g,kind:l,offerRtpParameters:f,streamId:h||f.rtcp.cname,trackId:p})}catch(e){c.e(e)}finally{c.f()}return v={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),r.next=9,t._pc.setRemoteDescription(v);case 9:return r.next=11,t._pc.createAnswer();case 11:y=r.sent,_=m.parse(y.sdp),w=o(e);try{for(w.s();!(S=w.n()).done;)u=S.value,p=u.trackId,f=u.rtpParameters,g=i.get(p),x=_.media.find((e=>String(e.mid)===g)),b.applyCodecParameters({offerRtpParameters:f,answerMediaObject:x})}catch(e){w.e(e)}finally{w.f()}if(y={type:"answer",sdp:m.write(_)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});case 19:return k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),r.next=22,t._pc.setLocalDescription(y);case 22:R=o(e),r.prev=23,R.s();case 25:if((P=R.n()).done){r.next=38;break}if(u=P.value,p=u.trackId,g=i.get(p),C=t._pc.getTransceivers().find((e=>e.mid===g))){r.next=34;break}throw new Error("new RTCRtpTransceiver not found");case 34:t._mapMidTransceiver.set(g,C),s.push({localId:g,track:C.receiver.track,rtpReceiver:C.receiver});case 36:r.next=25;break;case 38:r.next=43;break;case 40:r.prev=40,r.t0=r.catch(23),R.e(r.t0);case 43:return r.prev=43,R.f(),r.finish(43);case 46:return r.abrupt("return",s);case 47:case"end":return r.stop()}}),r,null,[[23,40,43,46]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,k.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("pauseReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="inactive",t._remoteSdp.pauseMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}resumeReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("resumeReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="recvonly",t._remoteSdp.resumeReceivingMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmits:p,protocol:i},k.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),h={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=P},7535:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;const m=r(9397),h=r(2267),g=f(r(4813)),v=f(r(3394)),b=f(r(2082)),y=r(4703),_=new m.Logger("Edge11");class w extends y.HandlerInterface{static createFactory(){return()=>new w}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){_.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e,t=d(this._rtpSenders.values());try{for(t.s();!(e=t.n()).done;){const t=e.value;try{t.stop()}catch(e){}}}catch(e){t.e(e)}finally{t.f()}var r,n=d(this._rtpReceivers.values());try{for(n.s();!(r=n.n()).done;){const e=r.value;try{e.stop()}catch(e){}}}catch(e){n.e(e)}finally{n.f()}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.debug("getNativeRtpCapabilities()"),e.abrupt("return",b.getCapabilities());case 2:case"end":return e.stop()}}),e)})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:{OS:0,MIS:0}});case 2:case"end":return e.stop()}}),e)})))()}run(e){e.direction;let t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,a=(e.sctpParameters,e.iceServers),s=e.iceTransportPolicy,i=(e.additionalSettings,e.proprietaryConstraints,e.extendedRtpCapabilities);_.debug("run()"),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",i),video:v.getSendingRtpParameters("video",i)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname=`CNAME-${g.generateRandomNumber()}`,this.setIceGatherer({iceServers:a,iceTransportPolicy:s}),this.setIceTransport(),this.setDtlsTransport()}updateIceServers(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(_.debug("restartIce()"),t._remoteIceParameters=e,t._transportReady){r.next=4;break}return r.abrupt("return");case 4:_.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling"),n=d(t._remoteIceCandidates);try{for(n.s();!(s=n.n()).done;)i=s.value,t._iceTransport.addRemoteCandidate(i)}catch(e){n.e(e)}finally{n.f()}t._iceTransport.addRemoteCandidate({});case 9:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._iceTransport.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,u,p,l,f,m,h;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.track,s=e.encodings,e.codecOptions,i=e.codec,_.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),t._transportReady){r.next=5;break}return r.next=5,t.setupTransport({localDtlsRole:"server"});case 5:_.debug("send() | calling new RTCRtpSender()"),o=new RTCRtpSender(n,t._dtlsTransport),(c=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(c.codecs,i),u=c.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType))),s||(s=[{}]),p=d(s);try{for(p.s();!(l=p.n()).done;)(f=l.value).ssrc=g.generateRandomNumber(),u&&(f.rtx={ssrc:g.generateRandomNumber()})}catch(e){p.e(e)}finally{p.f()}return c.encodings=s,c.rtcp={cname:t._cname,reducedSize:!0,mux:!0},m=b.mangleRtpParameters(c),_.debug("send() | calling rtpSender.send() [params:%o]",m),r.next=19,o.send(m);case 19:return h=String(t._nextSendLocalId),t._nextSendLocalId++,t._rtpSenders.set(h,o),r.abrupt("return",{localId:h,rtpParameters:c,rtpSender:o});case 23:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(_.debug("stopSending() [localId:%s]",e),n=t._rtpSenders.get(e)){r.next=4;break}throw new Error("RTCRtpSender not found");case 4:t._rtpSenders.delete(e),r.prev=5,_.debug("stopSending() | calling rtpSender.stop()"),n.stop(),r.next=14;break;case 10:throw r.prev=10,r.t0=r.catch(5),_.warn("stopSending() | rtpSender.stop() failed:%o",r.t0),r.t0;case 14:case"end":return r.stop()}}),r,null,[[5,10]])})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t?_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):_.debug("replaceTrack() [localId:%s, no track]",e),s=r._rtpSenders.get(e)){n.next=4;break}throw new Error("RTCRtpSender not found");case 4:s.setTrack(t);case 5:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._rtpSenders.get(e)){n.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=s.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=8,s.setParameters(i);case 8:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._rtpSenders.get(e)){n.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=s.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=c(c({},e),t)})),n.next=8,s.setParameters(i);case 8:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t._rtpSenders.get(e)){r.next=3;break}throw new Error("RTCRtpSender not found");case 3:return r.abrupt("return",n.getStats());case 4:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,u,p,l,f,m,h,g;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=[],s=d(e);try{for(s.s();!(i=s.n()).done;)o=i.value,c=o.trackId,u=o.kind,_.debug("receive() [trackId:%s, kind:%s]",c,u)}catch(e){s.e(e)}finally{s.f()}if(t._transportReady){r.next=6;break}return r.next=6,t.setupTransport({localDtlsRole:"server"});case 6:p=d(e),r.prev=7,p.s();case 9:if((l=p.n()).done){r.next=24;break}return o=l.value,c=o.trackId,u=o.kind,f=o.rtpParameters,_.debug("receive() | calling new RTCRtpReceiver()"),(m=new RTCRtpReceiver(t._dtlsTransport,u)).addEventListener("error",(e=>{_.error('rtpReceiver "error" event [event:%o]',e)})),h=b.mangleRtpParameters(f),_.debug("receive() | calling rtpReceiver.receive() [params:%o]",h),r.next=19,m.receive(h);case 19:g=c,t._rtpReceivers.set(g,m),n.push({localId:g,track:m.track,rtpReceiver:m});case 22:r.next=9;break;case 24:r.next=29;break;case 26:r.prev=26,r.t0=r.catch(7),p.e(r.t0);case 29:return r.prev=29,p.f(),r.finish(29);case 32:return r.abrupt("return",n);case 33:case"end":return r.stop()}}),r,null,[[7,26,29,32]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=d(e),r.prev=1,n.s();case 3:if((s=n.n()).done){r.next=13;break}if(i=s.value,_.debug("stopReceiving() [localId:%s]",i),o=t._rtpReceivers.get(i)){r.next=9;break}throw new Error("RTCRtpReceiver not found");case 9:t._rtpReceivers.delete(i);try{_.debug("stopReceiving() | calling rtpReceiver.stop()"),o.stop()}catch(e){_.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}case 11:r.next=3;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(1),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:case"end":return r.stop()}}),r,null,[[1,15,18,21]])})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t._rtpReceivers.get(e)){r.next=3;break}throw new Error("RTCRtpReceiver not found");case 3:return r.abrupt("return",n.getStats());case 4:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}setIceGatherer(e){let t=e.iceServers,r=e.iceTransportPolicy;const n=new RTCIceGatherer({iceServers:t||[],gatherPolicy:r||"all"});n.addEventListener("error",(e=>{_.error('iceGatherer "error" event [event:%o]',e)}));try{n.gather()}catch(e){_.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=n}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{_.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{_.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{_.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{_.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,_.debug("setupTransport()"),(s=t._dtlsTransport.getLocalParameters()).role=n,r.next=6,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:s},e,r)}));case 6:t._iceTransport.start(t._iceGatherer,t._remoteIceParameters,"controlling"),i=d(t._remoteIceCandidates);try{for(i.s();!(o=i.n()).done;)c=o.value,t._iceTransport.addRemoteCandidate(c)}catch(e){i.e(e)}finally{i.f()}t._iceTransport.addRemoteCandidate({}),t._remoteDtlsParameters.fingerprints=t._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),t._dtlsTransport.start(t._remoteDtlsParameters),t._transportReady=!0;case 13:case"end":return r.stop()}}),r)})))()}}t.Edge11=w},1697:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const m=f(r(372)),h=r(9397),g=r(2267),v=f(r(4813)),b=f(r(3394)),y=f(r(1078)),_=f(r(476)),w=r(4703),S=r(4128),x=r(3555),k=new h.Logger("Firefox60"),R={OS:16,MIS:2048};class P extends w.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s,i,o,c,d,u,p;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),n=r.captureStream(),s=n.getVideoTracks()[0],e.prev=6,t.addTransceiver("audio",{direction:"sendrecv"}),i=t.addTransceiver(s,{direction:"sendrecv"}),o=i.sender.getParameters(),c=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],o.encodings=c,e.next=14,i.sender.setParameters(o);case 14:return e.next=16,t.createOffer();case 16:d=e.sent;try{r.remove()}catch(e){}try{s.stop()}catch(e){}try{t.close()}catch(e){}return u=m.parse(d.sdp),p=y.extractRtpCapabilities({sdpObject:u}),e.abrupt("return",p);case 25:e.prev=25,e.t0=e.catch(6);try{r.remove()}catch(e){}try{s.stop()}catch(e){}try{t.close()}catch(e){}throw e.t0;case 31:case"end":return e.stop()}}),e,null,[[6,25]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:R});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;k.debug("run()"),this._direction=t,this._remoteSdp=new S.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",p),video:b.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",p),video:b.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new g.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,w,S,R,P,C,T,D;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),s&&(s=v.clone(s,[])).length>1&&(s.forEach(((e,t)=>{e.rid=`r${t}`})),s.reverse()),(d=v.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=b.reduceCodecs(d.codecs,c),(u=v.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=b.reduceCodecs(u.codecs,c),p=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream]}),!s){r.next=14;break}return(l=p.sender.getParameters()).encodings=s,r.next=14,p.sender.setParameters(l);case 14:return r.next=16,t._pc.createOffer();case 16:if(f=r.sent,h=m.parse(f.sdp),t._transportReady){r.next=21;break}return r.next=21,t.setupTransport({localDtlsRole:"client",localSdpObject:h});case 21:return g=(0,x.parse)((s||[{}])[0].scalabilityMode),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),r.next=25,t._pc.setLocalDescription(f);case 25:if(w=p.mid,d.mid=w,h=m.parse(t._pc.localDescription.sdp),S=h.media[h.media.length-1],d.rtcp.cname=y.getCname({offerMediaObject:S}),s?1===s.length?(R=_.getRtpEncodings({offerMediaObject:S}),Object.assign(R[0],s[0]),d.encodings=R):d.encodings=s.reverse():d.encodings=_.getRtpEncodings({offerMediaObject:S}),d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase())){P=o(d.encodings);try{for(P.s();!(C=P.n()).done;)(T=C.value).scalabilityMode?T.scalabilityMode=`L1T${g.temporalLayers}`:T.scalabilityMode="L1T3"}catch(e){P.e(e)}finally{P.f()}}return t._remoteSdp.send({offerMediaObject:S,offerRtpParameters:d,answerRtpParameters:u,codecOptions:i,extmapAllowMixed:!0}),D={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),r.next=37,t._pc.setRemoteDescription(D);case 37:return t._mapMidTransceiver.set(w,p),r.abrupt("return",{localId:w,rtpParameters:d,rtpSender:p.sender});case 39:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated transceiver not found");case 4:return n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.disableMediaSection(n.mid),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:t._mapMidTransceiver.delete(e);case 18:case"end":return r.stop()}}),r)})))()}pauseSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("pauseSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="inactive",t._remoteSdp.pauseMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}resumeSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("resumeSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="sendonly",t._remoteSdp.resumeSendingMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated transceiver not found");case 5:return i=s.sender.getParameters(),t=i.encodings.length-1-t,i.encodings.forEach(((e,r)=>{e.active=r>=t})),n.next=10,s.sender.setParameters(i);case 10:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=13,r._pc.createOffer();case 13:return o=n.sent,k.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=17,r._pc.setLocalDescription(o);case 17:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=21,r._pc.setRemoteDescription(c);case 21:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),d={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},k.debug("sendDataChannel() [options:%o]",d),u=t._pc.createDataChannel(o,d),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%R.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(p=r.sent,l=m.parse(p.sdp),f=l.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:"client",localSdpObject:l});case 15:return k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),r.next=18,t._pc.setLocalDescription(p);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:f}),h={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),r.next=23,t._pc.setRemoteDescription(h);case 23:t._hasDataChannelMediaSection=!0;case 24:return g={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},r.abrupt("return",{dataChannel:u,sctpStreamParameters:g});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,b,_,w,S,x,R,P;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=[],s=new Map,i=o(e);try{for(i.s();!(c=i.n()).done;)d=c.value,u=d.trackId,p=d.kind,l=d.rtpParameters,f=d.streamId,k.debug("receive() [trackId:%s, kind:%s]",u,p),h=l.mid||String(t._mapMidTransceiver.size),s.set(u,h),t._remoteSdp.receive({mid:h,kind:p,offerRtpParameters:l,streamId:f||l.rtcp.cname,trackId:u})}catch(e){i.e(e)}finally{i.f()}return g={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),r.next=9,t._pc.setRemoteDescription(g);case 9:return r.next=11,t._pc.createAnswer();case 11:v=r.sent,b=m.parse(v.sdp),_=o(e);try{for(_.s();!(w=_.n()).done;)d=w.value,u=d.trackId,l=d.rtpParameters,h=s.get(u),S=b.media.find((e=>String(e.mid)===h)),y.applyCodecParameters({offerRtpParameters:l,answerMediaObject:S}),v={type:"answer",sdp:m.write(b)}}catch(e){_.e(e)}finally{_.f()}if(t._transportReady){r.next=18;break}return r.next=18,t.setupTransport({localDtlsRole:"client",localSdpObject:b});case 18:return k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),r.next=21,t._pc.setLocalDescription(v);case 21:x=o(e),r.prev=22,x.s();case 24:if((R=x.n()).done){r.next=35;break}if(d=R.value,u=d.trackId,h=s.get(u),P=t._pc.getTransceivers().find((e=>e.mid===h))){r.next=31;break}throw new Error("new RTCRtpTransceiver not found");case 31:t._mapMidTransceiver.set(h,P),n.push({localId:h,track:P.receiver.track,rtpReceiver:P.receiver});case 33:r.next=24;break;case 35:r.next=40;break;case 37:r.prev=37,r.t0=r.catch(22),x.e(r.t0);case 40:return r.prev=40,x.f(),r.finish(40);case 43:return r.abrupt("return",n);case 44:case"end":return r.stop()}}),r,null,[[22,37,40,43]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,k.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("pauseReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="inactive",t._remoteSdp.pauseMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}resumeReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("resumeReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="recvonly",t._remoteSdp.resumeReceivingMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),o=n.streamId,c=n.ordered,d=n.maxPacketLifeTime,u=n.maxRetransmits,p={negotiated:!0,id:o,ordered:c,maxPacketLifeTime:d,maxRetransmits:u,protocol:i},k.debug("receiveDataChannel() [options:%o]",p),l=t._pc.createDataChannel(s,p),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),r.next=12,t._pc.setRemoteDescription(f);case 12:return r.next=14,t._pc.createAnswer();case 14:if(h=r.sent,t._transportReady){r.next=19;break}return g=m.parse(h.sdp),r.next=19,t.setupTransport({localDtlsRole:"client",localSdpObject:g});case 19:return k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),r.next=22,t._pc.setLocalDescription(h);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:l});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=y.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=P},4703:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const n=r(3170);class a extends n.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=a},6890:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var u=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},p=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&u(t,e,r);return p(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;const f=l(r(372)),m=r(9397),h=r(2267),g=l(r(4813)),v=l(r(3394)),b=l(r(1078)),y=l(r(3965)),_=r(4703),w=r(4128),S=new m.Logger("ReactNative"),x={OS:1024,MIS:1024};class k extends _.HandlerInterface{static createFactory(){return()=>new k}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(S.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=f.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,i=e.sctpParameters,o=e.iceServers,c=e.iceTransportPolicy,u=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;S.debug("run()"),this._direction=t,this._remoteSdp=new w.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",l),video:v.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",l),video:v.getSendingRemoteRtpParameters("video",l)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:o||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},u),p),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:S.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(S.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,m,h,_,w,x,k,R;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),c&&S.warn("send() | codec selection is not available in %s handler",t.name),t._sendStream.addTrack(n),t._pc.addStream(t._sendStream),r.next=8,t._pc.createOffer();case 8:if(u=r.sent,p=f.parse(u.sdp),(m=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(m.codecs),(h=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(h.codecs),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 17:return"video"===n.kind&&s&&s.length>1&&(S.debug("send() | enabling simulcast"),p=f.parse(u.sdp),l=p.media.find((e=>"video"===e.type)),y.addLegacySimulcast({offerMediaObject:l,track:n,numStreams:s.length}),u={type:"offer",sdp:f.write(p)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),r.next=21,t._pc.setLocalDescription(u);case 21:if(p=f.parse(t._pc.localDescription.sdp),l=p.media.find((e=>e.type===n.kind)),m.rtcp.cname=b.getCname({offerMediaObject:l}),m.encodings=y.getRtpEncodings({offerMediaObject:l,track:n}),s)for(_=0;_<m.encodings.length;++_)s[_]&&Object.assign(m.encodings[_],s[_]);if(m.encodings.length>1&&("video/vp8"===m.codecs[0].mimeType.toLowerCase()||"video/h264"===m.codecs[0].mimeType.toLowerCase())){w=o(m.encodings);try{for(w.s();!(x=w.n()).done;)x.value.scalabilityMode="L1T3"}catch(e){w.e(e)}finally{w.f()}}return t._remoteSdp.send({offerMediaObject:l,offerRtpParameters:m,answerRtpParameters:h,codecOptions:i}),k={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),r.next=32,t._pc.setRemoteDescription(k);case 32:return R=String(t._nextSendLocalId),t._nextSendLocalId++,t._mapSendLocalIdTrack.set(R,n),r.abrupt("return",{localId:R,rtpParameters:m});case 36:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),S.debug("stopSending() [localId:%s]",e),n=t._mapSendLocalIdTrack.get(e)){r.next=5;break}throw new Error("track not found");case 5:return t._mapSendLocalIdTrack.delete(e),t._sendStream.removeTrack(n),t._pc.addStream(t._sendStream),r.next=10,t._pc.createOffer();case 10:return s=r.sent,S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.prev=12,r.next=15,t._pc.setLocalDescription(s);case 15:r.next=23;break;case 17:if(r.prev=17,r.t0=r.catch(12),0!==t._sendStream.getTracks().length){r.next=22;break}return S.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.t0.toString()),r.abrupt("return");case 22:throw r.t0;case 23:if("stable"!==t._pc.signalingState){r.next=25;break}return r.abrupt("return");case 25:return i={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=29,t._pc.setRemoteDescription(i);case 29:case"end":return r.stop()}}),r,null,[[12,17]])})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}setMaxSpatialLayer(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}setRtpEncodingParameters(e,t){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}getSenderStats(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,m,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:i,protocol:c},S.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%x.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,m=f.parse(l.sdp),h=m.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:m});case 15:return S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,m,h,v,y,_,w,x,k,R,P,C,T,D,O;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,m=u.rtpParameters,S.debug("receive() [trackId:%s, kind:%s]",p,l),h=l,v=u.streamId||m.rtcp.cname,S.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),v+=`-hack-${g.generateRandomNumber()}`,i.set(p,v),t._remoteSdp.receive({mid:h,kind:l,offerRtpParameters:m,streamId:v,trackId:p})}catch(e){c.e(e)}finally{c.f()}return y={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",y),r.next=9,t._pc.setRemoteDescription(y);case 9:return r.next=11,t._pc.createAnswer();case 11:_=r.sent,w=f.parse(_.sdp),x=o(e);try{for(x.s();!(k=x.n()).done;)u=k.value,l=u.kind,m=u.rtpParameters,h=l,R=w.media.find((e=>String(e.mid)===h)),b.applyCodecParameters({offerRtpParameters:m,answerMediaObject:R})}catch(e){x.e(e)}finally{x.f()}if(_={type:"answer",sdp:f.write(w)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:w});case 19:return S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",_),r.next=22,t._pc.setLocalDescription(_);case 22:P=o(e),r.prev=23,P.s();case 25:if((C=P.n()).done){r.next=39;break}if(u=C.value,l=u.kind,p=u.trackId,m=u.rtpParameters,T=p,h=l,v=i.get(p),D=t._pc.getRemoteStreams().find((e=>e.id===v)),O=D.getTrackById(T)){r.next=35;break}throw new Error("remote track not found");case 35:t._mapRecvLocalIdInfo.set(T,{mid:h,rtpParameters:m}),s.push({localId:T,track:O});case 37:r.next=25;break;case 39:r.next=44;break;case 41:r.prev=41,r.t0=r.catch(23),P.e(r.t0);case 44:return r.prev=44,P.f(),r.finish(44);case 47:return r.abrupt("return",s);case 48:case"end":return r.stop()}}),r,null,[[23,41,44,47]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e);try{for(n.s();!(s=n.n()).done;)i=s.value,S.debug("stopReceiving() [localId:%s]",i),c=t._mapRecvLocalIdInfo.get(i)||{},d=c.mid,u=c.rtpParameters,t._mapRecvLocalIdInfo.delete(i),t._remoteSdp.planBStopReceiving({mid:d,offerRtpParameters:u})}catch(e){n.e(e)}finally{n.f()}return p={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),r.next=7,t._pc.setRemoteDescription(p);case 7:return r.next=9,t._pc.createAnswer();case 9:return l=r.sent,S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),r.next=13,t._pc.setLocalDescription(l);case 13:case"end":return r.stop()}}),r)})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}getReceiverStats(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new h.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,m,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmitTime:u,maxRetransmits:p,protocol:i},S.debug("receiveDataChannel() [options:%o]",l),m=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),h={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=f.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:m});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=f.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=k},4608:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(476)),_=f(r(9572)),w=r(4703),S=r(4128),x=r(3555),k=new h.Logger("ReactNativeUnifiedPlan"),R={OS:1024,MIS:1024};class P extends w.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(k.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),_.addNackSuppportForOpus(s),e.abrupt("return",s);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:R});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;k.debug("run()"),this._direction=t,this._remoteSdp=new S.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:k.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,S,R,P,C,T,D,O,M;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),s&&s.length>1&&s.forEach(((e,t)=>{e.rid=`r${t}`})),(u=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(u.codecs,c),(p=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(p.codecs,c),l=t._remoteSdp.getNextMediaSectionIdx(),f=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream],sendEncodings:s}),r.next=12,t._pc.createOffer();case 12:if(h=r.sent,_=m.parse(h.sdp),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:_});case 17:return S=!1,R=(0,x.parse)((s||[{}])[0].scalabilityMode),s&&1===s.length&&R.spatialLayers>1&&"video/vp9"===u.codecs[0].mimeType.toLowerCase()&&(k.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,_=m.parse(h.sdp),w=_.media[l.idx],y.addLegacySimulcast({offerMediaObject:w,numStreams:R.spatialLayers}),h={type:"offer",sdp:m.write(_)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),r.next=23,t._pc.setLocalDescription(h);case 23:if(P=f.mid,u.mid=P,_=m.parse(t._pc.localDescription.sdp),w=_.media[l.idx],u.rtcp.cname=b.getCname({offerMediaObject:w}),s?1===s.length?(C=y.getRtpEncodings({offerMediaObject:w}),Object.assign(C[0],s[0]),S&&(C=[C[0]]),u.encodings=C):u.encodings=s:u.encodings=y.getRtpEncodings({offerMediaObject:w}),u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase())){T=o(u.encodings);try{for(T.s();!(D=T.n()).done;)(O=D.value).scalabilityMode?O.scalabilityMode=`L1T${R.temporalLayers}`:O.scalabilityMode="L1T3"}catch(e){T.e(e)}finally{T.f()}}return t._remoteSdp.send({offerMediaObject:w,reuseMid:l.reuseMid,offerRtpParameters:u,answerRtpParameters:p,codecOptions:i,extmapAllowMixed:!0}),M={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),r.next=35,t._pc.setRemoteDescription(M);case 35:return t._mapMidTransceiver.set(P,f),r.abrupt("return",{localId:P,rtpParameters:u,rtpSender:f.sender});case 37:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch(e){}return r.next=11,t._pc.createOffer();case 11:return s=r.sent,k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=15,t._pc.setLocalDescription(s);case 15:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=19,t._pc.setRemoteDescription(i);case 19:t._mapMidTransceiver.delete(e);case 20:case"end":return r.stop()}}),r)})))()}pauseSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("pauseSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="inactive",t._remoteSdp.pauseMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}resumeSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("resumeSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e),t._remoteSdp.resumeSendingMediaSection(e),n){r.next=6;break}throw new Error("associated RTCRtpTransceiver not found");case 6:return n.direction="sendonly",r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},k.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%R.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,S,x,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,f=u.rtpParameters,h=u.streamId,k.debug("receive() [trackId:%s, kind:%s]",p,l),g=f.mid||String(t._mapMidTransceiver.size),i.set(p,g),t._remoteSdp.receive({mid:g,kind:l,offerRtpParameters:f,streamId:h||f.rtcp.cname,trackId:p})}catch(e){c.e(e)}finally{c.f()}return v={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),r.next=9,t._pc.setRemoteDescription(v);case 9:return r.next=11,t._pc.createAnswer();case 11:y=r.sent,_=m.parse(y.sdp),w=o(e);try{for(w.s();!(S=w.n()).done;)u=S.value,p=u.trackId,f=u.rtpParameters,g=i.get(p),x=_.media.find((e=>String(e.mid)===g)),b.applyCodecParameters({offerRtpParameters:f,answerMediaObject:x})}catch(e){w.e(e)}finally{w.f()}if(y={type:"answer",sdp:m.write(_)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});case 19:return k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),r.next=22,t._pc.setLocalDescription(y);case 22:R=o(e),r.prev=23,R.s();case 25:if((P=R.n()).done){r.next=38;break}if(u=P.value,p=u.trackId,g=i.get(p),C=t._pc.getTransceivers().find((e=>e.mid===g))){r.next=34;break}throw new Error("new RTCRtpTransceiver not found");case 34:t._mapMidTransceiver.set(g,C),s.push({localId:g,track:C.receiver.track,rtpReceiver:C.receiver});case 36:r.next=25;break;case 38:r.next=43;break;case 40:r.prev=40,r.t0=r.catch(23),R.e(r.t0);case 43:return r.prev=43,R.f(),r.finish(43);case 46:return r.abrupt("return",s);case 47:case"end":return r.stop()}}),r,null,[[23,40,43,46]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,k.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("pauseReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="inactive",t._remoteSdp.pauseMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}resumeReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("resumeReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="recvonly",t._remoteSdp.resumeReceivingMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmits:p,protocol:i},k.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),h={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNativeUnifiedPlan=P},7215:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(3965)),_=r(4703),w=r(4128),S=new h.Logger("Safari11"),x={OS:1024,MIS:1024};class k extends _.HandlerInterface{static createFactory(){return()=>new k}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(S.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",s);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;S.debug("run()"),this._direction=t,this._remoteSdp=new w.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:S.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(S.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,x,k,R,P;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),c&&S.warn("send() | codec selection is not available in %s handler",t.name),t._sendStream.addTrack(n),t._pc.addTrack(n,t._sendStream),r.next=8,t._pc.createOffer();case 8:if(u=r.sent,p=m.parse(u.sdp),(f=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(f.codecs),(h=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(h.codecs),t._transportReady){r.next=17;break}return r.next=17,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:p});case 17:return"video"===n.kind&&s&&s.length>1&&(S.debug("send() | enabling simulcast"),p=m.parse(u.sdp),l=p.media.find((e=>"video"===e.type)),y.addLegacySimulcast({offerMediaObject:l,track:n,numStreams:s.length}),u={type:"offer",sdp:m.write(p)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),r.next=21,t._pc.setLocalDescription(u);case 21:if(p=m.parse(t._pc.localDescription.sdp),l=p.media.find((e=>e.type===n.kind)),f.rtcp.cname=b.getCname({offerMediaObject:l}),f.encodings=y.getRtpEncodings({offerMediaObject:l,track:n}),s)for(_=0;_<f.encodings.length;++_)s[_]&&Object.assign(f.encodings[_],s[_]);if(f.encodings.length>1&&"video/vp8"===f.codecs[0].mimeType.toLowerCase()){w=o(f.encodings);try{for(w.s();!(x=w.n()).done;)x.value.scalabilityMode="L1T3"}catch(e){w.e(e)}finally{w.f()}}return t._remoteSdp.send({offerMediaObject:l,offerRtpParameters:f,answerRtpParameters:h,codecOptions:i}),k={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),r.next=32,t._pc.setRemoteDescription(k);case 32:return R=String(t._nextSendLocalId),t._nextSendLocalId++,P=t._pc.getSenders().find((e=>e.track===n)),t._mapSendLocalIdRtpSender.set(R,P),r.abrupt("return",{localId:R,rtpParameters:f,rtpSender:P});case 37:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapSendLocalIdRtpSender.get(e)){r.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return n.track&&t._sendStream.removeTrack(n.track),t._mapSendLocalIdRtpSender.delete(e),r.next=8,t._pc.createOffer();case 8:return s=r.sent,S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.prev=10,r.next=13,t._pc.setLocalDescription(s);case 13:r.next=21;break;case 15:if(r.prev=15,r.t0=r.catch(10),0!==t._sendStream.getTracks().length){r.next=20;break}return S.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.t0.toString()),r.abrupt("return");case 20:throw r.t0;case 21:if("stable"!==t._pc.signalingState){r.next=23;break}return r.abrupt("return");case 23:return i={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=27,t._pc.setRemoteDescription(i);case 27:case"end":return r.stop()}}),r,null,[[10,15]])})))()}pauseSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeSending(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):S.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=s.track,n.next=8,s.replaceTrack(t);case 8:i&&r._sendStream.removeTrack(i),t&&r._sendStream.addTrack(t);case 10:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=s.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.setParameters(i);case 9:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapSendLocalIdRtpSender.get(e)){n.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=s.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.setParameters(i);case 9:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapSendLocalIdRtpSender.get(e)){r.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.abrupt("return",n.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},S.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%x.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,x,k,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=o(e);try{for(i.s();!(c=i.n()).done;)d=c.value,u=d.trackId,p=d.kind,l=d.rtpParameters,f=d.streamId,S.debug("receive() [trackId:%s, kind:%s]",u,p),h=p,t._remoteSdp.receive({mid:h,kind:p,offerRtpParameters:l,streamId:f||l.rtcp.cname,trackId:u})}catch(e){i.e(e)}finally{i.f()}return g={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",g),r.next=8,t._pc.setRemoteDescription(g);case 8:return r.next=10,t._pc.createAnswer();case 10:v=r.sent,y=m.parse(v.sdp),_=o(e);try{for(_.s();!(w=_.n()).done;)d=w.value,p=d.kind,l=d.rtpParameters,h=p,x=y.media.find((e=>String(e.mid)===h)),b.applyCodecParameters({offerRtpParameters:l,answerMediaObject:x})}catch(e){_.e(e)}finally{_.f()}if(v={type:"answer",sdp:m.write(y)},t._transportReady){r.next=18;break}return r.next=18,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:y});case 18:return S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),r.next=21,t._pc.setLocalDescription(v);case 21:k=o(e),r.prev=22,k.s();case 24:if((R=k.n()).done){r.next=36;break}if(d=R.value,p=d.kind,u=d.trackId,l=d.rtpParameters,h=p,P=u,C=t._pc.getReceivers().find((e=>e.track&&e.track.id===P))){r.next=32;break}throw new Error("new RTCRtpReceiver not");case 32:t._mapRecvLocalIdInfo.set(P,{mid:h,rtpParameters:l,rtpReceiver:C}),s.push({localId:P,track:C.track,rtpReceiver:C});case 34:r.next=24;break;case 36:r.next=41;break;case 38:r.prev=38,r.t0=r.catch(22),k.e(r.t0);case 41:return r.prev=41,k.f(),r.finish(41);case 44:return r.abrupt("return",s);case 45:case"end":return r.stop()}}),r,null,[[22,38,41,44]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e);try{for(n.s();!(s=n.n()).done;)i=s.value,S.debug("stopReceiving() [localId:%s]",i),c=t._mapRecvLocalIdInfo.get(i)||{},d=c.mid,u=c.rtpParameters,t._mapRecvLocalIdInfo.delete(i),t._remoteSdp.planBStopReceiving({mid:d,offerRtpParameters:u})}catch(e){n.e(e)}finally{n.f()}return p={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),r.next=7,t._pc.setRemoteDescription(p);case 7:return r.next=9,t._pc.createAnswer();case 9:return l=r.sent,S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",l),r.next=13,t._pc.setLocalDescription(l);case 13:case"end":return r.stop()}}),r)})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapRecvLocalIdInfo.get(e)||{},s=n.rtpReceiver){r.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return r.abrupt("return",s.getStats());case 5:case"end":return r.stop()}}),r)})))()}pauseReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}resumeReceiving(e){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmits:p,protocol:i},S.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),h={type:"offer",sdp:t._remoteSdp.getSdp()},S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari11=k},9657:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(5158)),i=n(r(7686));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const m=f(r(372)),h=r(9397),g=f(r(4813)),v=f(r(3394)),b=f(r(1078)),y=f(r(476)),_=f(r(9572)),w=r(4703),S=r(4128),x=r(3555),k=new h.Logger("Safari12"),R={OS:1024,MIS:1024};class P extends w.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}getNativeRtpCapabilities(){return(0,i.default)(a.default.mark((function e(){var t,r,n,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),s=b.extractRtpCapabilities({sdpObject:n}),_.addNackSuppportForOpus(s),e.abrupt("return",s);case 15:e.prev=15,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))()}getNativeSctpCapabilities(){return(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:R});case 2:case"end":return e.stop()}}),e)})))()}run(e){let t=e.direction,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.iceServers,o=e.iceTransportPolicy,c=e.additionalSettings,d=e.proprietaryConstraints,p=e.extendedRtpCapabilities;k.debug("run()"),this._direction=t,this._remoteSdp=new S.RemoteSdp({iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:s}),this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",p),video:v.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",p),video:v.getSendingRemoteRtpParameters("video",p)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection(u({iceServers:i||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},c),d),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",(()=>{this.emit("@connectionstatechange",this._pc.connectionState)})):this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}updateIceServers(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:k.debug("updateIceServers()"),(n=t._pc.getConfiguration()).iceServers=e,t._pc.setConfiguration(n);case 4:case"end":return r.stop()}}),r)})))()}restartIce(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.debug("restartIce()"),t._remoteSdp.updateIceParameters(e),t._transportReady){r.next=4;break}return r.abrupt("return");case 4:if("send"!==t._direction){r.next=17;break}return r.next=7,t._pc.createOffer({iceRestart:!0});case 7:return n=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),r.next=11,t._pc.setLocalDescription(n);case 11:return s={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),r.next=15,t._pc.setRemoteDescription(s);case 15:r.next=27;break;case 17:return n={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),r.next=21,t._pc.setRemoteDescription(n);case 21:return r.next=23,t._pc.createAnswer();case 23:return s=r.sent,k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),r.next=27,t._pc.setLocalDescription(s);case 27:case"end":return r.stop()}}),r)})))()}getTransportStats(){var e=this;return(0,i.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._pc.getStats());case 1:case"end":return t.stop()}}),t)})))()}send(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,_,w,S,R,P,C,T,D,O;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.track,s=e.encodings,i=e.codecOptions,c=e.codec,t.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",n.kind,n.id),(u=g.clone(t._sendingRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(u.codecs,c),(p=g.clone(t._sendingRemoteRtpParametersByKind[n.kind],{})).codecs=v.reduceCodecs(p.codecs,c),l=t._remoteSdp.getNextMediaSectionIdx(),f=t._pc.addTransceiver(n,{direction:"sendonly",streams:[t._sendStream]}),r.next=11,t._pc.createOffer();case 11:if(h=r.sent,_=m.parse(h.sdp),t._transportReady){r.next=16;break}return r.next=16,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:_});case 16:return S=(0,x.parse)((s||[{}])[0].scalabilityMode),s&&s.length>1&&(k.debug("send() | enabling legacy simulcast"),_=m.parse(h.sdp),w=_.media[l.idx],y.addLegacySimulcast({offerMediaObject:w,numStreams:s.length}),h={type:"offer",sdp:m.write(_)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),r.next=21,t._pc.setLocalDescription(h);case 21:if(R=f.mid,u.mid=R,_=m.parse(t._pc.localDescription.sdp),w=_.media[l.idx],u.rtcp.cname=b.getCname({offerMediaObject:w}),u.encodings=y.getRtpEncodings({offerMediaObject:w}),s)for(P=0;P<u.encodings.length;++P)s[P]&&Object.assign(u.encodings[P],s[P]);if(u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase())){C=o(u.encodings);try{for(C.s();!(T=C.n()).done;)(D=T.value).scalabilityMode?D.scalabilityMode=`L1T${S.temporalLayers}`:D.scalabilityMode="L1T3"}catch(e){C.e(e)}finally{C.f()}}return t._remoteSdp.send({offerMediaObject:w,reuseMid:l.reuseMid,offerRtpParameters:u,answerRtpParameters:p,codecOptions:i}),O={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),r.next=34,t._pc.setRemoteDescription(O);case 34:return t._mapMidTransceiver.set(R,f),r.abrupt("return",{localId:R,rtpParameters:u,rtpSender:f.sender});case 36:case"end":return r.stop()}}),r)})))()}stopSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("stopSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:if(n.sender.replaceTrack(null),t._pc.removeTrack(n.sender),t._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch(e){}return r.next=11,t._pc.createOffer();case 11:return s=r.sent,k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=15,t._pc.setLocalDescription(s);case 15:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=19,t._pc.setRemoteDescription(i);case 19:t._mapMidTransceiver.delete(e);case 20:case"end":return r.stop()}}),r)})))()}pauseSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("pauseSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="inactive",t._remoteSdp.pauseMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}resumeSending(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),k.debug("resumeSending() [localId:%s]",e),n=t._mapMidTransceiver.get(e)){r.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.direction="sendonly",t._remoteSdp.resumeSendingMediaSection(e),r.next=9,t._pc.createOffer();case 9:return s=r.sent,k.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),r.next=13,t._pc.setLocalDescription(s);case 13:return i={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),r.next=17,t._pc.setRemoteDescription(i);case 17:case"end":return r.stop()}}),r)})))()}replaceTrack(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return n.next=7,s.sender.replaceTrack(t);case 7:case"end":return n.stop()}}),n)})))()}setMaxSpatialLayer(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{e.active=r<=t})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}setRtpEncodingParameters(e,t){var r=this;return(0,i.default)(a.default.mark((function n(){var s,i,o,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t),s=r._mapMidTransceiver.get(e)){n.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=s.sender.getParameters()).encodings.forEach(((e,r)=>{i.encodings[r]=u(u({},e),t)})),n.next=9,s.sender.setParameters(i);case 9:return r._remoteSdp.muxMediaSectionSimulcast(e,i.encodings),n.next=12,r._pc.createOffer();case 12:return o=n.sent,k.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",o),n.next=16,r._pc.setLocalDescription(o);case 16:return c={type:"answer",sdp:r._remoteSdp.getSdp()},k.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",c),n.next=20,r._pc.setRemoteDescription(c);case 20:case"end":return n.stop()}}),n)})))()}getSenderStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertSendDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.sender.getStats());case 5:case"end":return r.stop()}}),r)})))()}sendDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.ordered,s=e.maxPacketLifeTime,i=e.maxRetransmits,o=e.label,c=e.protocol,t.assertSendDirection(),u={negotiated:!0,id:t._nextSendSctpStreamId,ordered:n,maxPacketLifeTime:s,maxRetransmits:i,protocol:c},k.debug("sendDataChannel() [options:%o]",u),p=t._pc.createDataChannel(o,u),t._nextSendSctpStreamId=++t._nextSendSctpStreamId%R.MIS,t._hasDataChannelMediaSection){r.next=24;break}return r.next=9,t._pc.createOffer();case 9:if(l=r.sent,f=m.parse(l.sdp),h=f.media.find((e=>"application"===e.type)),t._transportReady){r.next=15;break}return r.next=15,t.setupTransport({localDtlsRole:null!==(d=t._forcedLocalDtlsRole)&&void 0!==d?d:"client",localSdpObject:f});case 15:return k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),r.next=18,t._pc.setLocalDescription(l);case 18:return t._remoteSdp.sendSctpAssociation({offerMediaObject:h}),g={type:"answer",sdp:t._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=23,t._pc.setRemoteDescription(g);case 23:t._hasDataChannelMediaSection=!0;case 24:return v={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits},r.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return r.stop()}}),r)})))()}receive(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l,f,h,g,v,y,_,w,S,x,R,P,C;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),s=[],i=new Map,c=o(e);try{for(c.s();!(d=c.n()).done;)u=d.value,p=u.trackId,l=u.kind,f=u.rtpParameters,h=u.streamId,k.debug("receive() [trackId:%s, kind:%s]",p,l),g=f.mid||String(t._mapMidTransceiver.size),i.set(p,g),t._remoteSdp.receive({mid:g,kind:l,offerRtpParameters:f,streamId:h||f.rtcp.cname,trackId:p})}catch(e){c.e(e)}finally{c.f()}return v={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),r.next=9,t._pc.setRemoteDescription(v);case 9:return r.next=11,t._pc.createAnswer();case 11:y=r.sent,_=m.parse(y.sdp),w=o(e);try{for(w.s();!(S=w.n()).done;)u=S.value,p=u.trackId,f=u.rtpParameters,g=i.get(p),x=_.media.find((e=>String(e.mid)===g)),b.applyCodecParameters({offerRtpParameters:f,answerMediaObject:x})}catch(e){w.e(e)}finally{w.f()}if(y={type:"answer",sdp:m.write(_)},t._transportReady){r.next=19;break}return r.next=19,t.setupTransport({localDtlsRole:null!==(n=t._forcedLocalDtlsRole)&&void 0!==n?n:"client",localSdpObject:_});case 19:return k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),r.next=22,t._pc.setLocalDescription(y);case 22:R=o(e),r.prev=23,R.s();case 25:if((P=R.n()).done){r.next=36;break}if(u=P.value,p=u.trackId,g=i.get(p),C=t._pc.getTransceivers().find((e=>e.mid===g))){r.next=32;break}throw new Error("new RTCRtpTransceiver not found");case 32:t._mapMidTransceiver.set(g,C),s.push({localId:g,track:C.receiver.track,rtpReceiver:C.receiver});case 34:r.next=25;break;case 36:r.next=41;break;case 38:r.prev=38,r.t0=r.catch(23),R.e(r.t0);case 41:return r.prev=41,R.f(),r.finish(41);case 44:return r.abrupt("return",s);case 45:case"end":return r.stop()}}),r,null,[[23,38,41,44]])})))()}stopReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u,p,l;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=13;break}if(i=s.value,k.debug("stopReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:t._remoteSdp.closeMediaSection(c.mid);case 11:r.next=4;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(2),n.e(r.t0);case 18:return r.prev=18,n.f(),r.finish(18);case 21:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=25,t._pc.setRemoteDescription(d);case 25:return r.next=27,t._pc.createAnswer();case 27:return u=r.sent,k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=31,t._pc.setLocalDescription(u);case 31:p=o(e);try{for(p.s();!(l=p.n()).done;)i=l.value,t._mapMidTransceiver.delete(i)}catch(e){p.e(e)}finally{p.f()}case 33:case"end":return r.stop()}}),r,null,[[2,15,18,21]])})))()}pauseReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("pauseReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="inactive",t._remoteSdp.pauseMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}resumeReceiving(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.assertRecvDirection(),n=o(e),r.prev=2,n.s();case 4:if((s=n.n()).done){r.next=14;break}if(i=s.value,k.debug("resumeReceiving() [localId:%s]",i),c=t._mapMidTransceiver.get(i)){r.next=10;break}throw new Error("associated RTCRtpTransceiver not found");case 10:c.direction="recvonly",t._remoteSdp.resumeReceivingMediaSection(i);case 12:r.next=4;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(2),n.e(r.t0);case 19:return r.prev=19,n.f(),r.finish(19);case 22:return d={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",d),r.next=26,t._pc.setRemoteDescription(d);case 26:return r.next=28,t._pc.createAnswer();case 28:return u=r.sent,k.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),r.next=32,t._pc.setLocalDescription(u);case 32:case"end":return r.stop()}}),r,null,[[2,16,19,22]])})))()}getReceiverStats(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.assertRecvDirection(),n=t._mapMidTransceiver.get(e)){r.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return r.abrupt("return",n.receiver.getStats());case 5:case"end":return r.stop()}}),r)})))()}receiveDataChannel(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i,o,c,d,u,p,l,f,h,g,v;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.sctpStreamParameters,s=e.label,i=e.protocol,t.assertRecvDirection(),c=n.streamId,d=n.ordered,u=n.maxPacketLifeTime,p=n.maxRetransmits,l={negotiated:!0,id:c,ordered:d,maxPacketLifeTime:u,maxRetransmits:p,protocol:i},k.debug("receiveDataChannel() [options:%o]",l),f=t._pc.createDataChannel(s,l),t._hasDataChannelMediaSection){r.next=23;break}return t._remoteSdp.receiveSctpAssociation(),h={type:"offer",sdp:t._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),r.next=12,t._pc.setRemoteDescription(h);case 12:return r.next=14,t._pc.createAnswer();case 14:if(g=r.sent,t._transportReady){r.next=19;break}return v=m.parse(g.sdp),r.next=19,t.setupTransport({localDtlsRole:null!==(o=t._forcedLocalDtlsRole)&&void 0!==o?o:"client",localSdpObject:v});case 19:return k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),r.next=22,t._pc.setLocalDescription(g);case 22:t._hasDataChannelMediaSection=!0;case 23:return r.abrupt("return",{dataChannel:f});case 24:case"end":return r.stop()}}),r)})))()}setupTransport(e){var t=this;return(0,i.default)(a.default.mark((function r(){var n,s,i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.localDtlsRole,(s=e.localSdpObject)||(s=m.parse(t._pc.localDescription.sdp)),(i=b.extractDtlsParameters({sdpObject:s})).role=n,t._remoteSdp.updateDtlsRole("client"===n?"server":"client"),r.next=7,new Promise(((e,r)=>{t.safeEmit("@connect",{dtlsParameters:i},e,r)}));case 7:t._transportReady=!0;case 8:case"end":return r.stop()}}),r)})))()}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari12=P},2082:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;const o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return i(t,e),t}(r(4813));t.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=o.clone(e,{});var r,a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){const e=r.value;if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}var s,i=n(e.rtcpFeedback||[]);try{for(i.s();!(s=i.n()).done;){const e=s.value;e.parameter||(e.parameter="")}}catch(e){i.e(e)}finally{i.f()}}}catch(e){a.e(e)}finally{a.f()}return t},t.mangleRtpParameters=function(e){const t=o.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);var r,a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){const e=r.value;e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType}}catch(e){a.e(e)}finally{a.f()}return t}},9572:function(e,t){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSuppportForOpus=void 0,t.addNackSuppportForOpus=function(e){var t,n,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,s=function(){};return{s:s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}(e.codecs||[]);try{for(a.s();!(n=a.n()).done;){const e=n.value;"audio/opus"!==e.mimeType.toLowerCase()&&"audio/multiopus"!==e.mimeType.toLowerCase()||(null===(t=e.rtcpFeedback)||void 0===t?void 0:t.some((e=>"nack"===e.type&&!e.parameter)))||(e.rtcpFeedback||(e.rtcpFeedback=[]),e.rtcpFeedback.push({type:"nack"}))}}catch(e){a.e(e)}finally{a.f()}}},5267:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const c=o(r(372)),d=o(r(4813));class u{constructor(e){let t=e.iceParameters,r=e.iceCandidates,a=e.dtlsParameters,s=e.planB,i=void 0!==s&&s;if(this._mediaObject={},this._planB=i,t&&this.setIceParameters(t),r){this._mediaObject.candidates=[];var o,c=n(r);try{for(c.s();!(o=c.n()).done;){const e=o.value,t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}}catch(e){c.e(e)}finally{c.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}a&&this.setDtlsRole(a.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}function p(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.MediaSection=u,t.AnswerMediaSection=class extends u{constructor(e){let t=e.iceParameters,r=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.plainRtpParameters,o=e.planB,c=void 0!==o&&o,u=e.offerMediaObject,l=e.offerRtpParameters,f=e.answerRtpParameters,m=e.codecOptions,h=e.extmapAllowMixed,g=void 0!==h&&h;switch(super({iceParameters:t,iceCandidates:r,dtlsParameters:a,planB:c}),this._mediaObject.mid=String(u.mid),this._mediaObject.type=u.type,this._mediaObject.protocol=u.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),u.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];var v,b=n(f.codecs);try{for(b.s();!(v=b.n()).done;){const e=v.value,t={payload:e.payloadType,codec:p(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=d.clone(e.parameters,{});let a=d.clone(e.rtcpFeedback,[]);if(m){const t=m.opusStereo,n=m.opusFec,s=m.opusDtx,i=m.opusMaxPlaybackRate,o=m.opusMaxAverageBitrate,c=m.opusPtime,d=m.opusNack,u=m.videoGoogleStartBitrate,p=m.videoGoogleMaxBitrate,f=m.videoGoogleMinBitrate,h=l.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==t&&(h.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(h.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==s&&(h.parameters.usedtx=s?1:0,r.usedtx=s?1:0),void 0!==i&&(r.maxplaybackrate=i),void 0!==o&&(r.maxaveragebitrate=o),void 0!==c&&(h.parameters.ptime=c,r.ptime=c),d||(h.rtcpFeedback=h.rtcpFeedback.filter((e=>"nack"!==e.type||e.parameter)),a=a.filter((e=>"nack"!==e.type||e.parameter)));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==u&&(r["x-google-start-bitrate"]=u),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==f&&(r["x-google-min-bitrate"]=f)}}const s={payload:e.payloadType,config:""};for(var y=0,_=Object.keys(r);y<_.length;y++){const e=_[y];s.config&&(s.config+=";"),s.config+=`${e}=${r[e]}`}s.config&&this._mediaObject.fmtp.push(s);var w,S=n(a);try{for(S.s();!(w=S.n()).done;){const t=w.value;this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}}catch(e){S.e(e)}finally{S.f()}}}catch(e){b.e(e)}finally{b.f()}this._mediaObject.payloads=f.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];var x,k=n(f.headerExtensions);try{for(k.s();!(x=k.n()).done;){const e=x.value;(u.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}}catch(e){k.e(e)}finally{k.f()}if(g&&"extmap-allow-mixed"===u.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),u.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:u.simulcast.list1},this._mediaObject.rids=[];var R,P=n(u.rids||[]);try{for(P.s();!(R=P.n()).done;){const e=R.value;"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}}catch(e){P.e(e)}finally{P.f()}}else if(u.simulcast_03){this._mediaObject.simulcast_03={value:u.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];var C,T=n(u.rids||[]);try{for(T.s();!(C=T.n()).done;){const e=C.value;"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}}catch(e){T.e(e)}finally{T.f()}}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof u.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize):u.sctpmap&&(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var t;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const r={};var a,s=n(e);try{for(s.s();!(a=s.n()).done;){const e=a.value;e.rid&&(r[e.rid]=e)}}catch(e){s.e(e)}finally{s.f()}const i=this._mediaObject.simulcast.list1,o=c.parseSimulcastStreamList(i);var d,u=n(o);try{for(u.s();!(d=u.n()).done;){var p,l=n(d.value);try{for(l.s();!(p=l.n()).done;){const e=p.value;e.paused=!(null===(t=r[e.scid])||void 0===t?void 0:t.active)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){u.e(e)}finally{u.f()}this._mediaObject.simulcast.list1=o.map((e=>e.map((e=>`${e.paused?"~":""}${e.scid}`)).join(","))).join(";")}},t.OfferMediaSection=class extends u{constructor(e){let t=e.iceParameters,r=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,i=e.plainRtpParameters,o=e.planB,c=void 0!==o&&o,d=e.mid,u=e.kind,l=e.offerRtpParameters,f=e.streamId,m=e.trackId,h=e.oldDataChannelSpec,g=void 0!==h&&h;switch(super({iceParameters:t,iceCandidates:r,dtlsParameters:a,planB:c}),this._mediaObject.mid=String(d),this._mediaObject.type=u,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=s?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),u){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${f||"-"} ${m}`);var v,b=n(l.codecs);try{for(b.s();!(v=b.n()).done;){const e=v.value,t={payload:e.payloadType,codec:p(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(var y=0,_=Object.keys(e.parameters);y<_.length;y++){const t=_[y];r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`}r.config&&this._mediaObject.fmtp.push(r);var w,S=n(e.rtcpFeedback);try{for(S.s();!(w=S.n()).done;){const t=w.value;this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}}catch(e){S.e(e)}finally{S.f()}}}catch(e){b.e(e)}finally{b.f()}this._mediaObject.payloads=l.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];var x,k=n(l.headerExtensions);try{for(k.s();!(x=k.n()).done;){const e=x.value;this._mediaObject.ext.push({uri:e.uri,value:e.id})}}catch(e){k.e(e)}finally{k.f()}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=l.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],l.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:l.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${f||"-"} ${m}`}),r&&(l.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:l.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${f||"-"} ${m}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":g?(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive(e){let t=e.offerRtpParameters,r=e.streamId,a=e.trackId;const s=t.encodings[0],i=s.ssrc,o=s.rtx&&s.rtx.ssrc?s.rtx.ssrc:void 0,c=this._mediaObject.payloads.split(" ");var d,u=n(t.codecs);try{for(u.s();!(d=u.n()).done;){const e=d.value;if(c.includes(String(e.payloadType)))continue;const t={payload:e.payloadType,codec:p(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(var l=0,f=Object.keys(e.parameters);l<f.length;l++){const t=f[l];r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`}r.config&&this._mediaObject.fmtp.push(r);var m,h=n(e.rtcpFeedback);try{for(h.s();!(m=h.n()).done;){const t=m.value;this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}}catch(e){h.e(e)}finally{h.f()}}}catch(e){u.e(e)}finally{u.f()}this._mediaObject.payloads+=` ${t.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),t.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${r||"-"} ${a}`}),o&&(t.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${r||"-"} ${a}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${o}`}))}planBStopReceiving(e){const t=e.offerRtpParameters.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==n)),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${n}`)))}}},4128:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return i(t,e),t}(r(372)),c=r(9397),d=r(5267),u=new c.Logger("RemoteSdp");t.RemoteSdp=class{constructor(e){let t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,a=e.sctpParameters,s=e.plainRtpParameters,i=e.planB,o=void 0!==i&&i;if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=t,this._iceCandidates=r,this._dtlsParameters=n,this._sctpParameters=a,this._plainRtpParameters=s,this._planB=o,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"animation-client"},name:"-",timing:{start:0,stop:0},media:[]},t&&t.iceLite&&(this._sdpObject.icelite="ice-lite"),n){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:n.fingerprints[e-1].algorithm,hash:n.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}s&&(this._sdpObject.origin.address=s.ip,this._sdpObject.origin.ipVer=s.ipVersion)}updateIceParameters(e){u.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setIceParameters(e)}catch(e){r.e(e)}finally{r.f()}}updateDtlsRole(e){u.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setDtlsRole(e)}catch(e){r.e(e)}finally{r.f()}}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send(e){let t=e.offerMediaObject,r=e.reuseMid,n=e.offerRtpParameters,a=e.answerRtpParameters,s=e.codecOptions,i=e.extmapAllowMixed,o=void 0!==i&&i;const c=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:t,offerRtpParameters:n,answerRtpParameters:a,codecOptions:s,extmapAllowMixed:o});r?this._replaceMediaSection(c,r):this._midToIndex.has(c.mid)?this._replaceMediaSection(c):this._addMediaSection(c)}receive(e){let t=e.mid,r=e.kind,n=e.offerRtpParameters,a=e.streamId,s=e.trackId;const i=this._midToIndex.get(t);let o;if(void 0!==i&&(o=this._mediaSections[i]),o)o.planBReceive({offerRtpParameters:n,streamId:a,trackId:s}),this._replaceMediaSection(o);else{o=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:t,kind:r,offerRtpParameters:n,streamId:a,trackId:s});const e=this._mediaSections.find((e=>e.closed));e?this._replaceMediaSection(o,e.mid):this._addMediaSection(o)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(u.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const r=this._findMediaSection(e);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}planBStopReceiving(e){let t=e.mid,r=e.offerRtpParameters;const n=this._findMediaSection(t);n.planBStopReceiving({offerRtpParameters:r}),this._replaceMediaSection(n)}sendSctpAssociation(e){let t=e.offerMediaObject;const r=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(r)}receiveSctpAssociation(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oldDataChannelSpec,t=void 0!==e&&e;const r=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:t});this._addMediaSection(r)}getSdp(){return this._sdpObject.origin.sessionVersion++,o.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},1078:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return i(t,e),t}(r(372));t.extractRtpCapabilities=function(e){let t=e.sdpObject;const r=new Map,a=[];let s=!1,i=!1;var c,d=n(t.media);try{for(d.s();!(c=d.n()).done;){const e=c.value,t=e.type;switch(t){case"audio":if(s)continue;s=!0;break;case"video":if(i)continue;i=!0;break;default:continue}var u,p=n(e.rtp);try{for(p.s();!(u=p.n()).done;){const e=u.value,n={kind:t,mimeType:`${t}/${e.codec}`,preferredPayloadType:e.payload,clockRate:e.rate,channels:e.encoding,parameters:{},rtcpFeedback:[]};r.set(n.preferredPayloadType,n)}}catch(e){p.e(e)}finally{p.f()}var l,f=n(e.fmtp||[]);try{for(f.s();!(l=f.n()).done;){const e=l.value,t=o.parseParams(e.config),n=r.get(e.payload);n&&(t&&t.hasOwnProperty("profile-level-id")&&(t["profile-level-id"]=String(t["profile-level-id"])),n.parameters=t)}}catch(e){f.e(e)}finally{f.f()}var m,h=n(e.rtcpFb||[]);try{for(h.s();!(m=h.n()).done;){const e=m.value,a={type:e.type,parameter:e.subtype};if(a.parameter||delete a.parameter,"*"!==e.payload){const t=r.get(e.payload);if(!t)continue;t.rtcpFeedback.push(a)}else{var g,v=n(r.values());try{for(v.s();!(g=v.n()).done;){const e=g.value;e.kind!==t||/.+\/rtx$/i.test(e.mimeType)||e.rtcpFeedback.push(a)}}catch(e){v.e(e)}finally{v.f()}}}}catch(e){h.e(e)}finally{h.f()}var b,y=n(e.ext||[]);try{for(y.s();!(b=y.n()).done;){const e=b.value;if(e["encrypt-uri"])continue;const r={kind:t,uri:e.uri,preferredId:e.value};a.push(r)}}catch(e){y.e(e)}finally{y.f()}}}catch(e){d.e(e)}finally{d.f()}return{codecs:Array.from(r.values()),headerExtensions:a}},t.extractDtlsParameters=function(e){let t=e.sdpObject;const r=(t.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!r)throw new Error("no active media section found");const n=r.fingerprint||t.fingerprint;let a;switch(r.setup){case"active":a="client";break;case"passive":a="server";break;case"actpass":a="auto"}return{role:a,fingerprints:[{algorithm:n.type,value:n.hash}]}},t.getCname=function(e){const t=(e.offerMediaObject.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function(e){let t=e.offerRtpParameters,r=e.answerMediaObject;var a,s=n(t.codecs);try{for(s.s();!(a=s.n()).done;){const e=a.value,t=e.mimeType.toLowerCase();if("audio/opus"!==t)continue;if(!(r.rtp||[]).find((t=>t.payload===e.payloadType)))continue;r.fmtp=r.fmtp||[];let n=r.fmtp.find((t=>t.payload===e.payloadType));n||(n={payload:e.payloadType,config:""},r.fmtp.push(n));const s=o.parseParams(n.config);switch(t){case"audio/opus":{const t=e.parameters["sprop-stereo"];void 0!==t&&(s.stereo=t?1:0);break}}n.config="";for(var i=0,c=Object.keys(s);i<c.length;i++){const e=c[i];n.config&&(n.config+=";"),n.config+=`${e}=${s[e]}`}}}catch(e){s.e(e)}finally{s.f()}}},3965:function(e,t,r){"use strict";var n=r(2831)(r(4958));function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){let t,r=e.offerMediaObject,s=e.track;const i=new Set;var o,c=a(r.ssrcs||[]);try{for(c.s();!(o=c.n()).done;){const e=o.value;if("msid"===e.attribute&&e.value.split(" ")[1]===s.id){const r=e.id;i.add(r),t||(t=r)}}}catch(e){c.e(e)}finally{c.f()}if(0===i.size)throw new Error(`a=ssrc line with msid information not found [track.id:${s.id}]`);const d=new Map;var u,p=a(r.ssrcGroups||[]);try{for(p.s();!(u=p.n()).done;){const e=u.value;if("FID"!==e.semantics)continue;let t=e.ssrcs.split(/\s+/),r=(0,n.default)(t,2),a=r[0],s=r[1];a=Number(a),s=Number(s),i.has(a)&&(i.delete(a),i.delete(s),d.set(a,s))}}catch(e){p.e(e)}finally{p.f()}var l,f=a(i);try{for(f.s();!(l=f.n()).done;){const e=l.value;d.set(e,null)}}catch(e){f.e(e)}finally{f.f()}const m=[];var h,g=a(d);try{for(g.s();!(h=g.n()).done;){const e=(0,n.default)(h.value,2),t=e[0],r=e[1],a={ssrc:t};r&&(a.rtx={ssrc:r}),m.push(a)}}catch(e){g.e(e)}finally{g.f()}return m},t.addLegacySimulcast=function(e){let t,r,n,a=e.offerMediaObject,s=e.track,i=e.numStreams;if(i<=1)throw new TypeError("numStreams must be greater than 1");if(!(a.ssrcs||[]).find((e=>"msid"===e.attribute&&(e.value.split(" ")[1]===s.id&&(t=e.id,n=e.value.split(" ")[0],!0)))))throw new Error(`a=ssrc line with msid information not found [track.id:${s.id}]`);(a.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const n=e.ssrcs.split(/\s+/);return Number(n[0])===t&&(r=Number(n[1]),!0)}));const o=a.ssrcs.find((e=>"cname"===e.attribute&&e.id===t));if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${s.id}]`);const c=o.value,d=[],u=[];for(let e=0;e<i;++e)d.push(t+e),r&&u.push(r+e);a.ssrcGroups=a.ssrcGroups||[],a.ssrcs=a.ssrcs||[],a.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let e=0;e<d.length;++e){const t=d[e];a.ssrcs.push({id:t,attribute:"cname",value:c}),a.ssrcs.push({id:t,attribute:"msid",value:`${n} ${s.id}`})}for(let e=0;e<u.length;++e){const t=d[e],r=u[e];a.ssrcs.push({id:r,attribute:"cname",value:c}),a.ssrcs.push({id:r,attribute:"msid",value:`${n} ${s.id}`}),a.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`})}}},476:function(e,t,r){"use strict";var n=r(2831)(r(4958));function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function(e){let t=e.offerMediaObject;const r=new Set;var s,i=a(t.ssrcs||[]);try{for(i.s();!(s=i.n()).done;){const e=s.value.id;r.add(e)}}catch(e){i.e(e)}finally{i.f()}if(0===r.size)throw new Error("no a=ssrc lines found");const o=new Map;var c,d=a(t.ssrcGroups||[]);try{for(d.s();!(c=d.n()).done;){const e=c.value;if("FID"!==e.semantics)continue;let t=e.ssrcs.split(/\s+/),a=(0,n.default)(t,2),s=a[0],i=a[1];s=Number(s),i=Number(i),r.has(s)&&(r.delete(s),r.delete(i),o.set(s,i))}}catch(e){d.e(e)}finally{d.f()}var u,p=a(r);try{for(p.s();!(u=p.n()).done;){const e=u.value;o.set(e,null)}}catch(e){p.e(e)}finally{p.f()}const l=[];var f,m=a(o);try{for(m.s();!(f=m.n()).done;){const e=(0,n.default)(f.value,2),t=e[0],r=e[1],a={ssrc:t};r&&(a.rtx={ssrc:r}),l.push(a)}}catch(e){m.e(e)}finally{m.f()}return l},t.addLegacySimulcast=function(e){let t=e.offerMediaObject,r=e.numStreams;if(r<=1)throw new TypeError("numStreams must be greater than 1");const a=(t.ssrcs||[]).find((e=>"msid"===e.attribute));if(!a)throw new Error("a=ssrc line with msid information not found");const s=a.value.split(" "),i=(0,n.default)(s,2),o=i[0],c=i[1],d=a.id;let u;(t.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===d&&(u=Number(t[1]),!0)}));const p=t.ssrcs.find((e=>"cname"===e.attribute));if(!p)throw new Error("a=ssrc line with cname information not found");const l=p.value,f=[],m=[];for(let e=0;e<r;++e)f.push(d+e),u&&m.push(u+e);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:f.join(" ")});for(let e=0;e<f.length;++e){const r=f[e];t.ssrcs.push({id:r,attribute:"cname",value:l}),t.ssrcs.push({id:r,attribute:"msid",value:`${o} ${c}`})}for(let e=0;e<m.length;++e){const r=f[e],n=m[e];t.ssrcs.push({id:n,attribute:"cname",value:l}),t.ssrcs.push({id:n,attribute:"msid",value:`${o} ${c}`}),t.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${n}`})}}},9466:function(e,t,r){"use strict";var n=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},a=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;const s=(i=r(1091))&&i.__esModule?i:{default:i};var i;t.debug=s.default;const o=r(7517);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return o.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return o.detectDevice}});const c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t}(r(5563));t.types=c,t.version="3.6.84";var d=r(3555);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return d.parse}})},3394:function(e,t,r){"use strict";function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const c=o(r(5052)),d=o(r(4813));function u(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(var a=0,s=Object.keys(e.parameters);a<s.length;a++){const t=s[a];let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var i,o=n(e.rtcpFeedback);try{for(o.s();!(i=o.n()).done;)p(i.value)}catch(e){o.e(e)}finally{o.f()}}function p(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function l(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function f(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)m(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var a,s=n(e.headerExtensions);try{for(s.s();!(a=s.n()).done;)h(a.value)}catch(e){s.e(e)}finally{s.f()}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);var i,o=n(e.encodings);try{for(o.s();!(i=o.n()).done;)g(i.value)}catch(e){o.e(e)}finally{o.f()}if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),v(e.rtcp)}function m(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(var a=0,s=Object.keys(e.parameters);a<s.length;a++){const t=s[a];let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var i,o=n(e.rtcpFeedback);try{for(o.s();!(i=o.n()).done;)p(i.value)}catch(e){o.e(e)}finally{o.f()}}function h(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(var t=0,r=Object.keys(e.parameters);t<r.length;t++){const n=r[t];let a=e.parameters[n];if(void 0===a&&(e.parameters[n]="",a=""),"string"!=typeof a&&"number"!=typeof a)throw new TypeError("invalid header extension parameter")}}function g(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function v(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function b(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function y(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function _(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.strict,a=void 0!==n&&n,s=r.modify,i=void 0!==s&&s;const o=e.mimeType.toLowerCase();if(o!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(o){case"video/h264":if(a){if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(!c.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=c.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}i&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(a&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function w(e,t){const r=[];var a,s=n(e.rtcpFeedback||[]);try{for(s.s();!(a=s.n()).done;){const e=a.value,n=(t.rtcpFeedback||[]).find((t=>t.type===e.type&&(t.parameter===e.parameter||!t.parameter&&!e.parameter)));n&&r.push(n)}}catch(e){s.e(e)}finally{s.f()}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;)u(t.value)}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var a,s=n(e.headerExtensions);try{for(s.s();!(a=s.n()).done;)l(a.value)}catch(e){s.e(e)}finally{s.f()}},t.validateRtpCodecCapability=u,t.validateRtcpFeedback=p,t.validateRtpHeaderExtension=l,t.validateRtpParameters=f,t.validateRtpCodecParameters=m,t.validateRtpHeaderExtensionParameters=h,t.validateRtpEncodingParameters=g,t.validateRtcpParameters=v,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");b(e.numStreams)},t.validateNumSctpStreams=b,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};var a,s=n(t.codecs||[]);try{for(s.s();!(a=s.n()).done;){const t=a.value;if(y(t))continue;const n=(e.codecs||[]).find((e=>_(e,t,{strict:!0,modify:!0})));if(!n)continue;const s={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:t.parameters,rtcpFeedback:w(n,t)};r.codecs.push(s)}}catch(e){s.e(e)}finally{s.f()}var i,o=n(r.codecs);try{for(o.s();!(i=o.n()).done;){const r=i.value,n=e.codecs.find((e=>y(e)&&e.parameters.apt===r.localPayloadType)),a=t.codecs.find((e=>y(e)&&e.parameters.apt===r.remotePayloadType));n&&a&&(r.localRtxPayloadType=n.preferredPayloadType,r.remoteRtxPayloadType=a.preferredPayloadType)}}catch(e){o.e(e)}finally{o.f()}var c,d=n(t.headerExtensions);try{for(d.s();!(c=d.n()).done;){const t=c.value,n=e.headerExtensions.find((e=>{return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(!n)continue;const a={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId,encrypt:n.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":a.direction="sendrecv";break;case"recvonly":a.direction="sendonly";break;case"sendonly":a.direction="recvonly";break;case"inactive":a.direction="inactive"}r.headerExtensions.push(a)}}catch(e){d.e(e)}finally{d.f()}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};var r,a=n(e.codecs);try{for(a.s();!(r=a.n()).done;){const e=r.value,n={mimeType:e.mimeType,kind:e.kind,preferredPayloadType:e.remotePayloadType,clockRate:e.clockRate,channels:e.channels,parameters:e.localParameters,rtcpFeedback:e.rtcpFeedback};if(t.codecs.push(n),!e.remoteRtxPayloadType)continue;const a={mimeType:`${e.kind}/rtx`,kind:e.kind,preferredPayloadType:e.remoteRtxPayloadType,clockRate:e.clockRate,parameters:{apt:e.remotePayloadType},rtcpFeedback:[]};t.codecs.push(a)}}catch(e){a.e(e)}finally{a.f()}var s,i=n(e.headerExtensions);try{for(i.s();!(s=i.n()).done;){const e=s.value;if("sendrecv"!==e.direction&&"recvonly"!==e.direction)continue;const r={kind:e.kind,uri:e.uri,preferredId:e.recvId,preferredEncrypt:e.encrypt,direction:e.direction};t.headerExtensions.push(r)}}catch(e){i.e(e)}finally{i.f()}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};var a,s=n(t.codecs);try{for(s.s();!(a=s.n()).done;){const t=a.value;if(t.kind!==e)continue;const n={mimeType:t.mimeType,payloadType:t.localPayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(r.codecs.push(n),t.localRtxPayloadType){const e={mimeType:`${t.kind}/rtx`,payloadType:t.localRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}}catch(e){s.e(e)}finally{s.f()}var i,o=n(t.headerExtensions);try{for(o.s();!(i=o.n()).done;){const t=i.value;if(t.kind&&t.kind!==e||"sendrecv"!==t.direction&&"sendonly"!==t.direction)continue;const n={uri:t.uri,id:t.sendId,encrypt:t.encrypt,parameters:{}};r.headerExtensions.push(n)}}catch(e){o.e(e)}finally{o.f()}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};var a,s=n(t.codecs);try{for(s.s();!(a=s.n()).done;){const t=a.value;if(t.kind!==e)continue;const n={mimeType:t.mimeType,payloadType:t.localPayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.remoteParameters,rtcpFeedback:t.rtcpFeedback};if(r.codecs.push(n),t.localRtxPayloadType){const e={mimeType:`${t.kind}/rtx`,payloadType:t.localRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}}catch(e){s.e(e)}finally{s.f()}var i,o=n(t.headerExtensions);try{for(o.s();!(i=o.n()).done;){const t=i.value;if(t.kind&&t.kind!==e||"sendrecv"!==t.direction&&"sendonly"!==t.direction)continue;const n={uri:t.uri,id:t.sendId,encrypt:t.encrypt,parameters:{}};r.headerExtensions.push(n)}}catch(e){o.e(e)}finally{o.f()}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))){var c,d=n(r.codecs);try{for(d.s();!(c=d.n()).done;){const e=c.value;e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type))}}catch(e){d.e(e)}finally{d.f()}}else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))){var u,p=n(r.codecs);try{for(p.s();!(u=p.n()).done;){const e=u.value;e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type))}}catch(e){p.e(e)}finally{p.f()}}else{var l,f=n(r.codecs);try{for(f.s();!(l=f.n()).done;){const e=l.value;e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type))}}catch(e){f.e(e)}finally{f.f()}}return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(_(e[n],t)){r.push(e[n]),y(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),y(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){f(e=d.clone(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(f(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}},3555:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=r.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},5563:function(e,t,r){"use strict";var n=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},a=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(7517),t),a(r(7167),t),a(r(9836),t),a(r(1767),t),a(r(129),t),a(r(2236),t),a(r(7139),t),a(r(2066),t),a(r(4703),t),a(r(2267),t)},4813:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},8933:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));const i=r(4019).EventEmitter,o=r(7090);e.exports=class extends i{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new o("EnhancedEventEmitter")}safeEmit(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit(e,...r)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}safeEmitAsPromise(e){var t=arguments,r=this;return(0,s.default)(a.default.mark((function n(){var s,i,o;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(s=t.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=t[o];return n.abrupt("return",new Promise(((t,n)=>{r.safeEmit(e,...i,t,n)})));case 2:case"end":return n.stop()}}),n)})))()}}},7090:function(e,t,r){"use strict";const n=r(3180),a="mentor-client";e.exports=class{constructor(e){e?(this._debug=n(`${a}:${e}`),this._warn=n(`${a}:WARN:${e}`),this._error=n(`${a}:ERROR:${e}`)):(this._debug=n(a),this._warn=n(`${a}:WARN`),this._error=n(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},2855:function(e,t,r){"use strict";const n=r(7090),a=r(6284).generateRandomNumber,s=new n("Message");e.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void s.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void s.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}s.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:a(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},7958:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const o=r(7090),c=r(8933),d=r(2855),u=new o("Peer");e.exports=class extends c{constructor(e){super(u),u.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw s}}}}(this._sents.values());try{for(t.s();!(e=t.n()).done;)e.value.close()}catch(e){t.e(e)}finally{t.f()}this.safeEmit("close")}}request(e){var t=arguments,r=this;return(0,s.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=t.length>1&&void 0!==t[1]?t[1]:void 0,i=d.createRequest(e,s),r._logger.debug("request() [method:%s, id:%s]",e,i.id),n.next=5,r._transport.send(i);case 5:return n.abrupt("return",new Promise(((e,t)=>{const n=1500*(15+.1*r._sents.size),a={id:i.id,method:i.method,resolve:t=>{r._sents.delete(i.id)&&(clearTimeout(a.timer),e(t))},reject:e=>{r._sents.delete(i.id)&&(clearTimeout(a.timer),t(e))},timer:setTimeout((()=>{r._sents.delete(i.id)&&t(new Error("request timeout"))}),n),close:()=>{clearTimeout(a.timer),t(new Error("peer closed"))}};r._sents.set(i.id,a)})));case 6:case"end":return n.stop()}}),n)})))()}notify(e){var t=arguments,r=this;return(0,s.default)(a.default.mark((function n(){var s,i;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=t.length>1&&void 0!==t[1]?t[1]:void 0,i=d.createNotification(e,s),r._logger.debug("notify() [method:%s]",e),n.next=5,r._transport.send(i);case 5:case"end":return n.stop()}}),n)})))()}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout((()=>{this._closed||(this._connected=!1,this.safeEmit("close"))}));this._transport.on("open",(()=>{this._closed||(u.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))})),this._transport.on("disconnected",(()=>{this._closed||(u.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))})),this._transport.on("failed",(e=>{this._closed||(u.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))})),this._transport.on("close",(()=>{this._closed||(this._closed=!0,u.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))})),this._transport.on("message",(e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,(t=>{const r=d.createSuccessResponse(e,t);this._transport.send(r).catch((()=>{}))}),((t,r)=>{t instanceof Error?(r=t.message,t=500):"number"==typeof t&&r instanceof Error&&(r=r.message);const n=d.createErrorResponse(e,t,r);this._transport.send(n).catch((()=>{}))}))}catch(t){const r=d.createErrorResponse(e,500,String(t));this._transport.send(r).catch((()=>{}))}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else u.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}},5381:function(e,t,r){"use strict";const n=r(8832).version,a=r(7958),s=r(2511);t.version=n,t.Peer=a,t.WebSocketTransport=s},2511:function(e,t,r){"use strict";var n=r(2831),a=n(r(8642)),s=n(r(7686));const i=r(4736).w3cwebsocket,o=r(3467),c=r(7090),d=r(8933),u=r(2855),p={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},l=new c("WebSocketTransport");e.exports=class extends d{constructor(e,t){super(l),l.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){l.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){l.error("close() | error closing the WebSocket: %o",e)}}}send(e){var t=this;return(0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t._closed){r.next=2;break}throw new Error("transport closed");case 2:r.prev=2,t._ws.send(JSON.stringify(e)),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),l.warn("send() failed:%o",r.t0),r.t0;case 10:case"end":return r.stop()}}),r,null,[[2,6]])})))()}_runWebSocket(){const e=o.operation(this._options.retry||p);let t=!1;e.attempt((r=>{this._closed?e.stop():(l.debug("_runWebSocket() [currentAttempt:%s]",r),this._ws=new i(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=n=>{if(!this._closed){if(l.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',n.wasClean,n.code,n.reason),4e3!==n.code){if(t){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",r),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||l.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const t=u.parse(e.data);t&&(0!==this.listenerCount("message")?this.safeEmit("message",t):l.error('no listeners for WebSocket "message" event, ignoring received message'))})}))}}},6284:function(e,t){"use strict";t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},4197:function(e,t,r){"use strict";var n=r(2831);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(6884));const s="chrome",i="opera",o="firefox",c="iexplorer",d="safari",u="nwjs",p="electron",l="react-native",f="unknown",m={Chrome:s,Chromium:s,Opera:i,Firefox:o,"Internet Explorer":c,Safari:d};function h(){const e=navigator.userAgent;if(e.match(/Electron/)){const t=e.match(/Electron\/([\d.]+)/)[1];return{name:p,version:t}}}function g(){const e=navigator.userAgent;if(e.match(/JitsiMeetNW/)){const t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return{name:u,version:t}}}function v(){const e=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i);let t;if(e||"ReactNative"===navigator.product){let r;return e&&e.length>2&&(r=e[1],t=e[2]),r||(r="react-native"),t||(t="unknown"),{name:l,version:t}}}const b=new class{constructor(e){let t,r;if(this._bowser=a.default.getParser(navigator.userAgent),void 0===e){const e=function(e){let t;const r=[v,h,g];for(let e=0;e<r.length;e++)if(t=r[e](),t)return t;const n=e.getBrowserName();return n in m?{name:m[n],version:e.getBrowserVersion()}:(t=function(){const e=navigator.userAgent,t={name:f,version:void 0};if(e.match(/Chrome/)&&!e.match(/Edge/))if(e.match(/Edg(A?)/)){const r=e.match(/Chrome\/([\d.]+)/)[1];Number.parseInt(r,10)>72&&(t.name=s,t.version=r)}else t.name=s,t.version=e.match(/Chrome\/([\d.]+)/)[1];return t}(),t||{name:f,version:void 0})}(this._bowser);t=e.name,r=e.version}else e.name in m?(t=m[e.name],r=e.version):(t=f,r=void 0);this._name=t,this._version=r}getName(){return this._name}isChrome(){return this._name===s}isOpera(){return this._name===i}isFirefox(){return this._name===o}isIExplorer(){return this._name===c}isSafari(){return this._name===d}isNWJS(){return this._name===u}isElectron(){return this._name===p}isReactNative(){return this._name===l}getVersion(){return this._version}_checkCondition(e){if(this._version)return this._bowser.satisfies(e)}isVersionGreaterThan(e){return this._checkCondition({[this._name]:`>${e}`})}isVersionLessThan(e){return this._checkCondition({[this._name]:`<${e}`})}isVersionEqualTo(e){return this._checkCondition({[this._name]:`~${e}`})}};var y={isSafariWithWebrtc:function(){return b.isSafari()&&!b.isVersionLessThan("11")},isMobile:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("mobile")},isIOS13:function(){const e=/iPad|iPhone|iPod/.test(navigator.platform),t="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,r=!!navigator.appVersion.match(/Version\/13\.(\d+)\.(\d+)/);return(e||t)&&r},usesNewGumFlow:function(){return b.isChrome()&&!b.isVersionLessThan("61")||b.isFirefox()||this.isSafariWithWebrtc()},requiresAdapter:function(){return b.isChrome()&&b.isVersionLessThan(55)},bowser:b};t.default=y},6861:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=function(e){const t=decodeURIComponent(location.search).match(new RegExp(e+"=([^&]+)(&|$)"));return t&&t[1]},n=r("size")||"300x300",a=n.split("x").map((e=>parseInt(e)));if(!(a[0]>0&&a[1]>0))throw new Error(`Can not parse resolution ${n}. Should be in 640x480 form`);const s=r("noiseSuppression");var i={size:{width:a[0],height:a[1]},server:r("server")||"wss://ovh.zix.net",roomId:r("roomId")||"xkxkTestRoom",slot:r("slot")||"1",streamId:r("streamId")||"testing",ignoredStreamId:r("streamId")||"",autoGain:-1===["false","f","n","0"].indexOf(r("autoGain")),noiseSuppression:!!s&&-1!==["true","t","y","1"].indexOf(s),full_server_url:null};t.default=i},9471:function(e,t,r){"use strict";var n=r(2831);Object.defineProperty(t,"__esModule",{value:!0}),t.loadAdapterIfNeeded=function(){return o.apply(this,arguments)};var a=n(r(8642)),s=n(r(7686)),i=n(r(4197));function o(){return(o=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.default.requiresAdapter()){e.next=4;break}return console.warn("Adding webrtc-adapter"),e.next=4,new Promise(((e,t)=>{const r=document.createElement("script");r.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/4.0.2/adapter.min.js"),r.onload=e,r.onerror=t,document.body.appendChild(r)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},5866:function(e,t,r){"use strict";var n=r(2831);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(8642)),s=n(r(7686)),i=n(r(3277)),o=n(r(5381)),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var i=a?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r(9466));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}class u extends i.default{constructor(e,t){let r=t.ignoredStreamId;super(),this.server=e+`?role=watcher&streamId=${encodeURIComponent(r)}`}connect(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("connecting to %s",e.server),e.transport=new o.default.WebSocketTransport(e.server),e.consumers=new Map,e.mentor=new o.default.Peer(e.transport),e.mentor.on("request",e._onmentorRequest.bind(e)),e.mentor.on("notification",e._onmentorNotification.bind(e)),t.next=8,new Promise((t=>e.mentor.on("open",(0,s.default)(a.default.mark((function r(){return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.emit("connected"),r.next=3,e._onopen();case 3:t();case 4:case"end":return r.stop()}}),r)}))))));case 8:case"end":return t.stop()}}),t)})))()}emitSpecialCode(e,t){if(!this.mentor)throw new Error("Not connected to the server");return this.mentor.notify("specialcode",{name:e,params:t})}_onopen(){var e=this;return(0,s.default)(a.default.mark((function t(){var r,n,s,i,o,d,u;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.animationDevice){t.next=7;break}return t.next=3,e.mentor.request("getRouterRtpCapabilities");case 3:return r=t.sent,e.animationDevice=new c.Device,t.next=7,e.animationDevice.load({routerRtpCapabilities:r});case 7:return t.next=9,e.mentor.request("transport",{rtpCapabilities:e.animationDevice.rtpCapabilities});case 9:n=t.sent,s=n.id,i=n.iceParameters,o=n.iceCandidates,d=n.dtlsParameters,u=n.sctpParameters,e.transport=e.animationDevice.createRecvTransport({id:s,iceParameters:i,iceCandidates:o,dtlsParameters:d,sctpParameters:u,iceServers:[]}),e.transport.on("connect",((t,r,n)=>{let a=t.dtlsParameters;e.mentor.request("connectTransport",{dtlsParameters:a}).then(r,n)})),e.transport.on("connectionstatechange",(t=>{"failed"===t&&(console.warn("ICE Connection failed"),e.mentor.notify("connectionFailed"))}));case 14:case"end":return t.stop()}}),t)})))()}_onmentorRequest(e,t,r){var n=this;return(0,s.default)(a.default.mark((function s(){var i,o,d,u,p,l,f,m,h,g,v;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.debug('proto "request" event [method:%s, data:%o]',e.method,e.data),a.t0=e.method,a.next="newConsumer"===a.t0?4:"videoCodecs"===a.t0?16:22;break;case 4:return(o=e.data).peerId,d=o.producerId,u=o.slot,p=o.id,l=o.kind,f=o.rtpParameters,o.type,o.producerPaused,u||r(400,"No slot specified"),a.next=8,n.transport.consume({id:p,producerId:d,kind:l,rtpParameters:f});case 8:return m=a.sent,null===(i=n.consumers.get(u))||void 0===i||i.close(),n.consumers.set(u,m),m.on("transportclose",(()=>{n.consumers.delete(u)})),(h=c.parseScalabilityMode(m.rtpParameters.encodings[0].scalabilityMode)).spatialLayers,h.temporalLayers,n.emit("newTrack",{slot:u,track:m.track}),t(),a.abrupt("break",23);case 16:return g=n.animationDevice._handlerFactory(),a.next=19,g.getNativeRtpCapabilities();case 19:return v=a.sent,t(v.codecs.filter((e=>"video"===e.kind))),a.abrupt("break",23);case 22:console.error('unknown request.method "%s"',e.method);case 23:case"end":return a.stop()}}),s)})))()}_onmentorNotification(e){var t=this;return(0,s.default)(a.default.mark((function r(){var n,s,i,o,c,d,u;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:console.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),r.t0=e.method,r.next="specialcode"===r.t0?4:"consumerClosed"===r.t0?7:13;break;case 4:return n=e.data,s=n.name,i=n.params,t.emit("specialcode",{name:s,params:i}),r.abrupt("break",14);case 7:return c=e.data,d=c.slot,u=c.temporary,d||reject(400,"No slot specified"),null===(o=t.consumers.get(d))||void 0===o||o.close(),t.consumers.delete(d),t.emit("badTrack",{slot:d,temporary:u}),r.abrupt("break",14);case 13:console.error('unknown notification.method "%s"',e.method);case 14:case"end":return r.stop()}}),r)})))()}}t.default=u},6372:function(e,t,r){"use strict";var n=r(2831);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(8642)),s=n(r(7686)),i=n(r(6861)),o=n(r(4197)),c=n(r(5866)),d=r(9471);const u="__unused__";class p{constructor(e){this.options=Object.assign({},i.default,e),this.players=new Map,this.muted=!1,this.communicator=new c.default(this.serverURL(),{ignoredStreamId:this.options.ignoredStreamId}),this.communicator.on("connected",(()=>this.onwebsocketconnected())),this.communicator.on("specialcode",(e=>{let t=e.name,r=e.params;return this.onspecialcode(t,r)})),this.communicator.on("newTrack",this._onNewTrack.bind(this)),this.communicator.on("badTrack",this._onBadTrack.bind(this))}start(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.loadAdapterIfNeeded)();case 2:return t.next=4,e.communicator.connect();case 4:case"end":return t.stop()}}),t)})))()}serverURL(){return this.options.full_server_url?this.options.full_server_url:`${this.options.server}:8084/${this.options.roomId}`}emitSpecialCode(e,t){return this.communicator.emitSpecialCode(e,t)}mute(){this.muted=!0,this.players.forEach((e=>e.muted=this.muted))}unmute(){this.muted=!1,this.players.forEach((e=>e.muted=this.muted))}onstart(){}onwebsocketconnected(){}onspecialcode(e,t){console.log("special code",e,t)}onnewplayer(e){}_onNewTrack(e){let t=e.slot,r=e.track,n=this.players.get(t);n||(this.players.has(u)?(n=this.players.get(u),this.players.delete(u)):n=this._createPlayer(),this.players.set(t,n)),n.srcObject=new MediaStream([r])}_createPlayer(){const e=document.createElement("audio");return e.setAttribute("autoplay",""),e.muted=this.muted,e.addEventListener("canplay",(()=>{setTimeout((()=>{e.paused&&!this._onuserplaycalled&&(this._onuserplaycalled=!0,this.onuserplay((()=>{this._onuserplaycalled=!1,this.players.forEach((e=>e.play()))})))}),100)})),this.onnewplayer(e),e}_onBadTrack(e){let t=e.slot,r=e.temporary;const n=this.players.get(t);n&&(r?n.srcObject=null:(this.players.size>1||this.players.has(u)?n.remove():(n.srcObject=null,this.players.set(u,n)),this.players.delete(t)))}}p.browser=o.default;var l=p;t.default=l},6884:function(e){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),a=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var a=e.getVersionPrecision(t),s=e.getVersionPrecision(r),i=Math.max(a,s),o=0,c=e.map([t,r],(function(t){var r=i-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(o=i-Math.min(a,s)),i-=1;i>=o;){if(c[0][i]>c[1][i])return 1;if(c[0][i]===c[1][i]){if(i===o)return 0;i-=1}else if(c[0][i]<c[1][i])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var a=e[r];if(t(a,r))return a}},e.assign=function(e){for(var t,r,n=e,a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var o=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=a,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new a.default(e,t)},e.parse=function(e){return new a.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&i(t.prototype,null),r&&i(t,r),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=c(r(92)),a=c(r(93)),s=c(r(94)),i=c(r(95)),o=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,a={},s=0;if(Object.keys(e).forEach((function(t){var i=e[t];"string"==typeof i?(a[t]=i,s+=1):"object"==typeof i&&(r[t]=i,n+=1)})),n>0){var i=Object.keys(r),c=o.default.find(i,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var u=o.default.find(i,(function(e){return t.isPlatform(e)}));if(u){var p=this.satisfies(r[u]);if(void 0!==p)return p}}if(s>0){var l=Object.keys(a),f=o.default.find(l,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(a[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),a=o.default.getBrowserTypeByAlias(n);return t&&a&&(n=a.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,a=this.getBrowserVersion();if("string"==typeof a)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(a,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},s=/version\/(\d+(\.?_?\d+)+)/i,i=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=a.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=a.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=a.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=a.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=a.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=a.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=a.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=a.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=a.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=a.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=a.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=a.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=a.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=a.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=a.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=a.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=a.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=a.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=a.default.getFirstMatch(s,e)||a.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=a.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=a.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=a.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=a.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=a.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=a.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=a.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=a.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=a.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=a.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:a.default.getFirstMatch(t,e),version:a.default.getSecondMatch(t,e)}}}];t.default=i,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:[/Roku\/DVP/],describe:function(e){var t=a.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=a.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=a.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=a.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=a.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=a.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=a.default.getMacOSVersionName(t),n={name:s.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=a.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=a.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=a.default.getAndroidVersionName(t),n={name:s.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=a.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=a.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||a.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||a.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=a.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=a.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=a.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=i,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=a.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=a.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=i,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=a.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=a.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=a.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=a.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=a.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=i,e.exports=t.default}})},3277:function(e){function t(e){if(e)return function(e){for(var r in t.prototype)e[r]=t.prototype[r];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<n.length;a++)if((r=n[a])===t||r.fn===t){n.splice(a,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var a=(r=r.slice(0)).length;n<a;++n)r[n].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}},6632:function(e){var t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},4019:function(e){"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function a(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",a),r([].slice.call(arguments))}h(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&h(e,"error",t,{once:!0})}(e,a)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var i=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var a,s,i,d;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),i=s[t]),void 0===i)i=s[t]=r,++e._eventsCount;else if("function"==typeof i?i=s[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),(a=c(e))>0&&i.length>a&&!i.warned){i.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=i.length,d=u,console&&console.warn&&console.warn(d)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=u.bind(n);return a.listener=r,n.wrapFn=a,a}function l(e,t,r){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:"function"==typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):m(a,a.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function h(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(s){n.once&&e.removeEventListener(t,a),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var a="error"===e,s=this._events;if(void 0!==s)a=a&&void 0===s.error;else if(!a)return!1;if(a){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var d=c.length,u=m(c,d);for(r=0;r<d;++r)n(u[r],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,a,s,i;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){i=r[s].listener,a=s;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,i||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(a=s[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return l(this,e,!0)},s.prototype.rawListeners=function(e){return l(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5052:function(e,t,r){const n=r(5809)("h264-profile-level-id");n.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class a{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=a;const s=new a(1,31);class i{constructor(e){this._mask=~d("x",e),this._maskedValue=d("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class o{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const c=[new o(66,new i("x1xx0000"),1),new o(77,new i("1xxx0000"),1),new o(88,new i("11xx0000"),1),new o(66,new i("x0xx0000"),2),new o(88,new i("10xx0000"),2),new o(77,new i("0x0x0000"),3),new o(100,new i("00000000"),5),new o(100,new i("00001100"),4)];function d(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function u(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,s=t>>8&255,i=t>>16&255;let o;switch(r){case 11:o=0!=(16&s)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:o=r;break;default:return n("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of c)if(i===e.profile_idc&&e.profile_iop.isMatch(s))return new a(e.profile,o);return n("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return n("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return n("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):s},t.isSameProfile=function(e={},r={}){const n=t.parseSdpProfileLevelId(e),a=t.parseSdpProfileLevelId(r);return Boolean(n&&a&&n.profile===a.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return n("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);if(!s)throw new TypeError("invalid local_profile_level_id");if(!i)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==i.profile)throw new TypeError("H264 Profile mismatch");const o=u(e)&&u(r),c=s.level,d=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(p=c,l=i.level)?p:l;var p,l;const f=o?c:d;return n("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,f),t.profileLevelIdToString(new a(s.profile,f))}},5809:function(e,t,r){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(a=n))})),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(811)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},811:function(e,t,r){e.exports=function(e){function t(e){let r,a,s,i=null;function o(...e){if(!o.enabled)return;const n=o,a=Number(new Date),s=a-(r||a);n.diff=s,n.prev=r,n.curr=a,r=a,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,a)=>{if("%%"===r)return"%";i++;const s=t.formatters[a];if("function"==typeof s){const t=e[i];r=s.call(n,t),e.splice(i,1),i--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(a!==t.namespaces&&(a=t.namespaces,s=t.enabled(e)),s),set:e=>{i=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(a),...t.skips.map(a).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(r=0;r<a;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(5746),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},5746:function(e){var t=1e3,r=60*t,n=60*r,a=24*n;function s(e,t,r,n){var a=t>=1.5*r;return Math.round(e/r)+" "+n+(a?"s":"")}e.exports=function(e,i){i=i||{};var o,c,d=typeof e;if("string"===d&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var i=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===d&&isFinite(e))return i.long?(o=e,(c=Math.abs(o))>=a?s(o,c,a,"day"):c>=n?s(o,c,n,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=a?Math.round(e/a)+"d":s>=n?Math.round(e/n)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3350:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const a=n(r(1091)),s="awaitqueue";t.Logger=class{constructor(e){e?(this._debug=(0,a.default)(`${s}:${e}`),this._warn=(0,a.default)(`${s}:WARN:${e}`),this._error=(0,a.default)(`${s}:ERROR:${e}`)):(this._debug=(0,a.default)(s),this._warn=(0,a.default)(`${s}:WARN`),this._error=(0,a.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},5822:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;const n=new(r(3350).Logger);class a extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}}t.AwaitQueueStoppedError=a;class s extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,s)}}t.AwaitQueueRemovedTaskError=s,t.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,t){if(t=null!=t?t:e.name,n.debug(`push() [name:${t}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,a)=>{const s={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(s.completed)return;s.completed=!0,this.pendingTasks.delete(s.id),n.debug(`resolving task [name:${s.name}]`),r(e);const[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!s.completed&&(s.completed=!0,this.pendingTasks.delete(s.id),n.debug(`rejecting task [name:${s.name}]: %s`,String(e)),a(e),!this.stopping)){const[e]=this.pendingTasks.values();e&&!e.executedAt&&this.execute(e)}}};this.pendingTasks.set(s.id,s),1===this.pendingTasks.size&&this.execute(s)}))}stop(){n.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())n.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new a);this.stopping=!1}remove(e){n.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];t?t.reject(new s):n.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map((r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0})))}async execute(e){if(n.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}},1091:function(e,t,r){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(a=n))})),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(3899)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},3899:function(e,t,r){e.exports=function(e){function t(e){let r,a,s,i=null;function o(...e){if(!o.enabled)return;const n=o,a=Number(new Date),s=a-(r||a);n.diff=s,n.prev=r,n.curr=a,r=a,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,a)=>{if("%%"===r)return"%";i++;const s=t.formatters[a];if("function"==typeof s){const t=e[i];r=s.call(n,t),e.splice(i,1),i--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(a!==t.namespaces&&(a=t.namespaces,s=t.enabled(e)),s),set:e=>{i=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(a),...t.skips.map(a).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(r=0;r<a;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(5887),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},5887:function(e){var t=1e3,r=60*t,n=60*r,a=24*n;function s(e,t,r,n){var a=t>=1.5*r;return Math.round(e/r)+" "+n+(a?"s":"")}e.exports=function(e,i){i=i||{};var o,c,d=typeof e;if("string"===d&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var i=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===d&&isFinite(e))return i.long?(o=e,(c=Math.abs(o))>=a?s(o,c,a,"day"):c>=n?s(o,c,n,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=a?Math.round(e/a)+"d":s>=n?Math.round(e/n)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3180:function(e,t,r){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(a=n))})),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(7258)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},7258:function(e,t,r){e.exports=function(e){function t(e){let r,a,s,i=null;function o(...e){if(!o.enabled)return;const n=o,a=Number(new Date),s=a-(r||a);n.diff=s,n.prev=r,n.curr=a,r=a,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,a)=>{if("%%"===r)return"%";i++;const s=t.formatters[a];if("function"==typeof s){const t=e[i];r=s.call(n,t),e.splice(i,1),i--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(a!==t.namespaces&&(a=t.namespaces,s=t.enabled(e)),s),set:e=>{i=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(a),...t.skips.map(a).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(r=0;r<a;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(6878),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},6878:function(e){var t=1e3,r=60*t,n=60*r,a=24*n;function s(e,t,r,n){var a=t>=1.5*r;return Math.round(e/r)+" "+n+(a?"s":"")}e.exports=function(e,i){i=i||{};var o,c,d=typeof e;if("string"===d&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var i=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===d&&isFinite(e))return i.long?(o=e,(c=Math.abs(o))>=a?s(o,c,a,"day"):c>=n?s(o,c,n,"hour"):c>=r?s(o,c,r,"minute"):c>=t?s(o,c,t,"second"):o+" ms"):function(e){var s=Math.abs(e);return s>=a?Math.round(e/a)+"d":s>=n?Math.round(e/n)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7521:function(e,t,r){let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:r.g):e=>(n||(n=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},3467:function(e,t,r){e.exports=r(7507)},7507:function(e,t,r){var n=r(8587);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],a=0;a<t.retries;a++)n.push(this.createTimeout(a,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(a,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var a in n=[],e)"function"==typeof e[a]&&n.push(a);for(var s=0;s<n.length;s++){var i=n[s],o=e[i];e[i]=function(n){var a=t.operation(r),s=Array.prototype.slice.call(arguments,1),i=s.pop();s.push((function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),i.apply(this,arguments))})),a.attempt((function(){n.apply(e,s)}))}.bind(e,o),e[i].options=r}}},8587:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,a=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&a.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var a=this._errors[n],s=a.message,i=(e[s]||0)+1;e[s]=i,i>=r&&(t=a,r=i)}return t}},1299:function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},372:function(e,t,r){var n=r(4561),a=r(2154);t.write=a,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},4561:function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},a=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:a?t[e.name]:t;!function(e,t,r,a){if(a&&!r)t[a]=n(e[1]);else for(var s=0;s<r.length;s+=1)null!=e[s+1]&&(t[r[s]]=n(e[s+1]))}(r.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=r(1299),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var o=0;o<(s[t]||[]).length;o+=1){var c=s[t][o];if(c.reg.test(i))return a(c,n,i)}})),t.media=r,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),a=0;a<r.length;a+=3)t.push({component:r[a],ip:r[a+1],port:r[a+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},2154:function(e,t,r){var n=r(1299),a=/%[sdv%]/g,s=function(e){var t=1,r=arguments,n=r.length;return e.replace(a,(function(e){if(t>=n)return e;var a=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}}))},i=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var i=t.names[a];t.name?n.push(r[t.name][i]):n.push(r[t.names[a]])}else n.push(r[t.name]);return s.apply(null,n)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||o,a=t.innerOrder||c,s=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(i(t,r,e))}))}))})),e.media.forEach((function(e){s.push(i("m",n.m[0],e)),a.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?s.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){s.push(i(t,r,e))}))}))}))})),s.join("\r\n")+"\r\n"}},4736:function(e,t,r){var n;if("object"==typeof globalThis)n=globalThis;else try{n=r(6632)}catch(e){}finally{if(n||"undefined"==typeof window||(n=window),!n)throw new Error("Could not determine global this")}var a=n.WebSocket||n.MozWebSocket,s=r(1201);function i(e,t){return t?new a(e,t):new a(e)}a&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(i,e,{get:function(){return a[e]}})})),e.exports={w3cwebsocket:a?i:null,version:s}},1201:function(e,t,r){e.exports=r(5516).version},5119:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},5838:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},7686:function(e){function t(e,t,r,n,a,s,i){try{var o=e[s](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(a,s){var i=e.apply(r,n);function o(e){t(i,a,s,o,c,"next",e)}function c(e){t(i,a,s,o,c,"throw",e)}o(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},5158:function(e,t,r){var n=r(5429);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},2831:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},5130:function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,s,i,o=[],c=!0,d=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=s.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){d=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw a}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},7014:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},4420:function(e,t,r){var n=r(3051).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},r=Object.prototype,s=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",d=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof h?t:h,s=Object.create(a.prototype),o=new T(n||[]);return i(s,"_invoke",{value:k(e,r,o)}),s}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var m={};function h(){}function g(){}function v(){}var b={};p(b,c,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(D([])));_&&_!==r&&s.call(_,c)&&(b=_);var w=v.prototype=h.prototype=Object.create(b);function S(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(a,i,o,c){var d=f(e[a],e,i);if("throw"!==d.type){var u=d.arg,p=u.value;return p&&"object"==n(p)&&s.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,o,c)}),(function(e){r("throw",e,o,c)})):t.resolve(p).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,c)}))}c(d.arg)}var a;i(this,"_invoke",{value:function(e,n){function s(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(s,s):s()}})}function k(e,t,r){var n="suspendedStart";return function(a,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw s;return{value:void 0,done:!0}}for(r.method=a,r.arg=s;;){var i=r.delegate;if(i){var o=R(i,r);if(o){if(o===m)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=f(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function R(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,R(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var a=f(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,m;var s=a.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function D(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(s.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:O}}function O(){return{value:void 0,done:!0}}return g.prototype=v,i(w,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:g,configurable:!0}),g.displayName=p(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,p(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(x.prototype),p(x.prototype,d,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,a,s){void 0===s&&(s=Promise);var i=new x(l(e,r,n,a),s);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(w),p(w,u,"Generator"),p(w,c,(function(){return this})),p(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=s.call(a,"catchLoc"),c=s.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},4958:function(e,t,r){var n=r(5838),a=r(5130),s=r(9826),i=r(7014);e.exports=function(e,t){return n(e)||a(e,t)||s(e,t)||i()},e.exports.__esModule=!0,e.exports.default=e.exports},3871:function(e,t,r){var n=r(3051).default;e.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},5429:function(e,t,r){var n=r(3051).default,a=r(3871);e.exports=function(e){var t=a(e,"string");return"symbol"===n(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},3051:function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},9826:function(e,t,r){var n=r(5119);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},8642:function(e,t,r){var n=r(4420)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},8832:function(e){"use strict";e.exports=JSON.parse('{"name":"mentor-client","version":"4.0.6","description":"mentor JavaScript client module","author":"Iñaki Baz Castillo <ibc@aliax.net>","homepage":"https://mentor.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/mentor.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},5516:function(e){"use strict";e.exports={version:"1.0.34"}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){"use strict";var e=r(2831)(r(6372));r.g.Watcher=e.default}()}();